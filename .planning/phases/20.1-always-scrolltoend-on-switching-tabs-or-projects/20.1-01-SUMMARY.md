---
phase: 20.1-always-scrolltoend-on-switching-tabs-or-projects
plan: 01
subsystem: ui
tags: [xterm, terminal, settings, i18n, scroll]

# Dependency graph
requires:
  - phase: 20-bugfix-swap-projects-selected-tab
    provides: setActiveTerminal with savedScrollPositions and lastActivePerProject Maps
provides:
  - scrollToBottom on xterm tab switch gated by getSetting('autoScrollOnSwitch') !== false
  - autoScrollOnSwitch settings toggle in Terminal group with !== false default
  - i18n keys for autoScrollOnSwitch in en and fr locales
affects: [future terminal UX phases, settings panel additions]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "getSetting !== false guard for default-enabled settings (safe upgrade path)"
    - "xterm viewportY restore skipped when autoScrollOnSwitch enabled to prevent flicker"

key-files:
  created: []
  modified:
    - src/renderer/ui/components/TerminalManager.js
    - src/renderer/ui/panels/SettingsPanel.js
    - src/renderer/i18n/locales/en.json
    - src/renderer/i18n/locales/fr.json

key-decisions:
  - "20.1-01: autoScrollOnSwitch uses !== false guard — undefined/missing defaults to enabled (safe upgrade path)"
  - "20.1-01: scrollToBottom placed after fitAddon.fit() and terminal.focus() in the else-if branch — only fires for xterm tabs, not chat tabs"
  - "20.1-01: xterm viewportY restore skipped when autoScrollOnSwitch is enabled — avoids restore-then-scroll flicker"
  - "20.1-01: No separate hook in filterByProject needed — it already calls setActiveTerminal which triggers the scroll"

patterns-established:
  - "Phase 20.1: settings-toggle input auto-wiring via .settings-toggle input selector handles new toggles without extra addEventListener"

requirements-completed: []

# Metrics
duration: 5min
completed: 2026-02-27
---

# Phase 20.1 Plan 01: Always ScrollToEnd on Switching Tabs or Projects Summary

**xterm tabs auto-scroll to bottom on switch via getSetting guard in setActiveTerminal, with a Terminal-group settings toggle defaulting to enabled**

## Performance

- **Duration:** ~5 min
- **Started:** 2026-02-27T09:29:07Z
- **Completed:** 2026-02-27T09:34:00Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- setActiveTerminal now calls termData.terminal.scrollToBottom() for all xterm tabs when autoScrollOnSwitch !== false
- xterm viewportY restore skipped when autoScrollOnSwitch is enabled, preventing restore-then-scroll flicker
- Settings panel Terminal group has new toggle defaulting to checked (enabled), wired via saveSettingsHandler
- en.json and fr.json have autoScrollOnSwitch and autoScrollOnSwitchDesc keys with proper UTF-8 French

## Task Commits

Each task was committed atomically:

1. **Task 1: Add scrollToBottom call in setActiveTerminal and settings toggle wiring** - `d537f243` (feat)
2. **Task 2: Add i18n keys for autoScrollOnSwitch setting** - `75d206c0` (feat)

## Files Created/Modified
- `src/renderer/ui/components/TerminalManager.js` - scrollToBottom in non-chat branch, skip viewportY restore when enabled
- `src/renderer/ui/panels/SettingsPanel.js` - toggle HTML in Terminal group, reading in saveSettingsHandler, inclusion in newSettings
- `src/renderer/i18n/locales/en.json` - autoScrollOnSwitch and autoScrollOnSwitchDesc keys
- `src/renderer/i18n/locales/fr.json` - French translations with proper UTF-8 characters

## Decisions Made
- autoScrollOnSwitch uses !== false guard so undefined/missing key defaults to enabled — safe upgrade path for existing users
- scrollToBottom placed after fitAddon.fit() and terminal.focus() inside the else-if (non-chat) branch — chat tabs keep their scroll position
- xterm viewportY restore skipped when enabled to avoid visible flicker (restore-then-scroll in same frame)
- No separate hook needed in filterByProject — it already calls setActiveTerminal which triggers the scroll

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## Next Phase Readiness
- Auto-scroll-to-bottom feature complete and verified
- npm test passes (281/281), npm run build:renderer succeeds
- Ready for PR creation against upstream

---
*Phase: 20.1-always-scrolltoend-on-switching-tabs-or-projects*
*Completed: 2026-02-27*

---
phase: 20.1-always-scrolltoend-on-switching-tabs-or-projects
verified: 2026-02-27T10:00:00Z
status: passed
score: 6/6 must-haves verified
re_verification: false
---

# Phase 20.1: Always ScrollToEnd on Switching Tabs or Projects — Verification Report

**Phase Goal:** Always scroll to end when switching terminal tabs or projects, with a settings toggle to disable.
**Verified:** 2026-02-27T10:00:00Z
**Status:** passed
**Re-verification:** No — initial verification

---

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Switching terminal tabs scrolls xterm to the bottom automatically | VERIFIED | `TerminalManager.js:1227-1229` — `scrollToBottom()` called in `setActiveTerminal` non-chat branch when `getSetting('autoScrollOnSwitch') !== false` |
| 2 | Switching projects scrolls the newly active xterm tab to the bottom automatically | VERIFIED | `filterByProject` calls `setActiveTerminal(targetId)` at line 2304; scroll fires through the same branch |
| 3 | Chat tabs do NOT auto-scroll on switch (only xterm tabs) | VERIFIED | `setActiveTerminal` line 1218-1222: chat branch only calls `chatView.focus()` with no scroll; scroll logic is in the `else if (termData.type !== 'file')` branch |
| 4 | User can disable auto-scroll-on-switch via a toggle in Terminal settings group | VERIFIED | `SettingsPanel.js:731-743` — toggle HTML rendered inside `settings.terminalGroup` card with id `auto-scroll-on-switch-toggle`; read in `saveSettingsHandler` at line 1246-1247; included in `newSettings` at line 1282 |
| 5 | Setting defaults to enabled (safe upgrade path with !== false guard) | VERIFIED | `TerminalManager.js:1227` — `getSetting('autoScrollOnSwitch') !== false`; `SettingsPanel.js:740` — `${settings.autoScrollOnSwitch !== false ? 'checked' : ''}` |
| 6 | Toggle takes effect immediately without reload (call-time getSetting read) | VERIFIED | `getSetting('autoScrollOnSwitch')` is called inside `setActiveTerminal` at runtime (lines 1227, 1256), not cached at module load — setting is read on every tab switch |

**Score:** 6/6 truths verified

---

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/renderer/ui/components/TerminalManager.js` | scrollToBottom call in setActiveTerminal for xterm tabs, gated by getSetting | VERIFIED | Lines 1226-1229: `if (getSetting('autoScrollOnSwitch') !== false) { termData.terminal.scrollToBottom(); }` inside `else if (termData.type !== 'file')` block. Also: xterm viewportY restore skipped when setting enabled (lines 1254-1259) to prevent flicker |
| `src/renderer/ui/panels/SettingsPanel.js` | autoScrollOnSwitch toggle in Terminal settings group | VERIFIED | Lines 734-743: toggle HTML in Terminal group; lines 1246-1247: read in saveSettingsHandler; line 1282: included in newSettings object |
| `src/renderer/i18n/locales/en.json` | i18n keys for autoScrollOnSwitch label and description | VERIFIED | Lines 606-607: `"autoScrollOnSwitch": "Auto-scroll to bottom on tab switch"` and `"autoScrollOnSwitchDesc": "Automatically scroll terminals to the latest output when switching tabs or projects"` under `settings` object |
| `src/renderer/i18n/locales/fr.json` | French i18n keys for autoScrollOnSwitch label and description | VERIFIED | Lines 672-673: `"autoScrollOnSwitch": "Défilement auto vers le bas au changement d'onglet"` and `"autoScrollOnSwitchDesc": "Défiler automatiquement les terminaux vers la dernière sortie lors du changement d'onglet ou de projet"` — proper UTF-8 French with accented characters |

---

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| `TerminalManager.js setActiveTerminal` | `xterm terminal.scrollToBottom()` | `getSetting('autoScrollOnSwitch') !== false` guard | WIRED | Line 1227: guard present; line 1228: `scrollToBottom()` called inside it; pattern confirmed |
| `SettingsPanel.js` | `settings.autoScrollOnSwitch` | Toggle checkbox wired via saveSettingsHandler | WIRED | Toggle id `auto-scroll-on-switch-toggle` present (line 740); read at line 1246-1247; persisted at line 1282 via `newSettings` object passed to `saveSetting` |

---

### Requirements Coverage

No requirement IDs declared for this gap closure phase.

---

### Anti-Patterns Found

No anti-patterns found in phase-modified code. The grep for TODO/FIXME/PLACEHOLDER matched only pre-existing code unrelated to phase 20.1:
- `dragPlaceholder` variable (line 84) — drag-drop DOM variable, unrelated
- `// Create placeholder` comment (line 935) — drag-drop tab placeholder, unrelated

---

### Human Verification Required

#### 1. Visual confirmation of auto-scroll on tab switch

**Test:** Open a project with multiple terminals. Let terminal 1 accumulate output, scroll up in it, then switch to terminal 2, then switch back to terminal 1.
**Expected:** Terminal 1 snaps to the bottom (latest output visible) on switch back.
**Why human:** xterm scroll state cannot be verified programmatically from a static grep.

#### 2. Chat tab scroll position preserved

**Test:** Open a project with a chat tab containing long history. Scroll up partway, switch to a terminal tab, then switch back to the chat tab.
**Expected:** Chat tab retains the previous scroll position (does NOT snap to bottom).
**Why human:** Runtime rendering behavior requiring visual confirmation.

#### 3. Settings toggle disables auto-scroll

**Test:** Open Settings, navigate to Terminal group, uncheck "Auto-scroll to bottom on tab switch". Switch between terminal tabs.
**Expected:** Terminals no longer auto-scroll to bottom; previous scroll positions are restored instead.
**Why human:** Runtime toggle effect requires interactive testing.

---

### Gaps Summary

No gaps. All 6 observable truths verified, all 4 artifacts substantive and wired, both key links confirmed.

The implementation is complete and correct:
- `scrollToBottom()` is placed after `fitAddon.fit()` and `terminal.focus()` in the non-chat branch of `setActiveTerminal`, exactly as specified
- xterm viewportY restore is gated by `getSetting('autoScrollOnSwitch') === false` to avoid restore-then-scroll flicker
- Chat tab scroll restore path is preserved independently (chat branch handles its own `scrollTop`)
- `filterByProject` → `setActiveTerminal` chain ensures project switches also trigger the scroll without a separate hook
- Both commits (`d537f243`, `75d206c0`) verified present in git history

---

_Verified: 2026-02-27T10:00:00Z_
_Verifier: Claude (gsd-verifier)_

# Phase 5.1: Save Explorer-State within app starts and remember Scroll-Position - Context

**Gathered:** 2026-02-25
**Status:** Ready for planning

<domain>
## Phase Boundary

Two goals: (1) Fix explorer state (expanded folders, panel visibility) being lost on app restart — Phase 5 handles project switches but state is not surviving cold starts. (2) Add scroll position persistence for the file tree, so the explorer looks exactly as the user left it after restarts and project switches.

</domain>

<decisions>
## Implementation Decisions

### Scroll position scope
- File tree scroll only — no editor previews or other scrollable containers
- Per-project scroll position — each project remembers its own scroll position independently

### Restore behavior
- Unified flow for both app startup and project switch — same code path
- Wait for folder expansion to complete, then restore scroll position (expand first, scroll after DOM settles)
- Instant scrollTop set — no animation or visual feedback, feels like explorer never changed
- If saved position exceeds current tree height, clamp to max scroll (scroll to end)

### Save triggers
- Debounced on scroll events (e.g., 500ms debounce) — captures latest position without write spam
- Also save on app close / before-quit — flush any pending scroll position to prevent data loss
- Save on project switch (existing Phase 5 pattern)

### Persistence
- Disk persistence — survives app restarts and crashes
- Stored alongside existing explorer state data (Phase 5's storage mechanism)

### App restart fix
- Explorer state (expanded folders, panel visibility from Phase 5) is lost on cold start — this must be fixed
- Root cause needs investigation: Phase 5 saves state but startup restore may not be reading it back

### Claude's Discretion
- Debounce interval tuning (500ms suggested, adjust as needed)
- DOM settle detection strategy (MutationObserver, requestAnimationFrame, or setTimeout)
- Exact integration point with Phase 5's existing save/restore infrastructure

</decisions>

<specifics>
## Specific Ideas

- The explorer should look exactly as the user left it — expanded folders, scroll position, everything intact
- "Restarting the app loses every explorer-state" — this is the primary pain point driving this phase

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 5.1-save-explorer-state-within-app-starts-and-remember-scroll-position*
*Context gathered: 2026-02-25*

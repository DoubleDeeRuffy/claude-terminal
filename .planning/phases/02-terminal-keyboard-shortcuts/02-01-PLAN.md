---
phase: 02-terminal-keyboard-shortcuts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/windows/MainWindow.js
  - src/main/preload.js
  - renderer.js
  - src/renderer/ui/components/TerminalManager.js
autonomous: true
requirements:
  - TERM-05
must_haves:
  truths:
    - "Ctrl+Tab switches to the next terminal tab"
    - "Ctrl+Shift+Tab switches to the previous terminal tab"
    - "Ctrl+Left and Ctrl+Right no longer switch terminal tabs"
    - "Ctrl+Up and Ctrl+Down still switch projects as before"
  artifacts:
    - path: "src/main/windows/MainWindow.js"
      provides: "before-input-event narrowed to Up/Down only; Ctrl+Tab intercepted and forwarded via ctrl-tab IPC channel"
      contains: "ctrl-tab"
    - path: "src/main/preload.js"
      provides: "onCtrlTab listener exposed to renderer"
      contains: "onCtrlTab"
    - path: "renderer.js"
      provides: "Ctrl+Tab IPC listener wired to switchTerminal"
      contains: "onCtrlTab"
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Ctrl+Left/Right tab-switch branch removed from createTerminalKeyHandler"
  key_links:
    - from: "src/main/windows/MainWindow.js"
      to: "renderer.js"
      via: "ctrl-tab IPC channel"
      pattern: "send\\('ctrl-tab'"
    - from: "src/main/preload.js"
      to: "renderer.js"
      via: "onCtrlTab listener bridge"
      pattern: "onCtrlTab.*createListener"
    - from: "renderer.js"
      to: "switchTerminal"
      via: "onCtrlTab callback"
      pattern: "onCtrlTab.*switchTerminal"
---

<objective>
Remap terminal tab-switching from Ctrl+Arrow to Ctrl+Tab/Ctrl+Shift+Tab across all three keyboard input layers (main process before-input-event, preload bridge, renderer handler).

Purpose: Free Ctrl+Left/Right for word-jump (TERM-03 in next plan) while giving users the standard Ctrl+Tab terminal-switching shortcut.
Output: Tab-switching works via Ctrl+Tab; Ctrl+Arrow no longer intercepted for tab-switching.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-terminal-keyboard-shortcuts/02-RESEARCH.md
@src/main/windows/MainWindow.js
@src/main/preload.js
@renderer.js
@src/renderer/ui/components/TerminalManager.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remap before-input-event and add Ctrl+Tab IPC channel</name>
  <files>
    src/main/windows/MainWindow.js
    src/main/preload.js
    renderer.js
  </files>
  <action>
**MainWindow.js — before-input-event handler (lines ~42-53):**

1. Narrow the Ctrl+Arrow interception to ONLY Up/Down (for project switching). Remove Left/Right from the direction map entirely. After this change, Ctrl+Left and Ctrl+Right will pass through to the renderer (needed for word-jump in plan 02-02).

2. Add Ctrl+Tab interception in the same `before-input-event` handler. When `input.control && input.key === 'Tab'`:
   - Call `event.preventDefault()`
   - Send `mainWindow.webContents.send('ctrl-tab', input.shift ? 'prev' : 'next')`
   - Return early (do not fall through to the Ctrl+Arrow logic)

The Ctrl+Tab check MUST come before the Ctrl+Arrow check in the handler.

**preload.js — window namespace:**

Add `onCtrlTab: createListener('ctrl-tab')` to the `window` namespace object, alongside the existing `onCtrlArrow: createListener('ctrl-arrow')`. Follow the exact same pattern.

**renderer.js — switchTerminal listener:**

Add a `api.window.onCtrlTab(...)` listener alongside the existing `api.window.onCtrlArrow(...)` listener (around line 1395-1399). Wire it to call `switchTerminal`:
```js
api.window.onCtrlTab((dir) => {
  if (dir === 'next') switchTerminal('right');
  else if (dir === 'prev') switchTerminal('left');
});
```

Place it immediately after the existing `onCtrlArrow` listener block for readability.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && node -e "const fs=require('fs'); const mw=fs.readFileSync('src/main/windows/MainWindow.js','utf8'); const pl=fs.readFileSync('src/main/preload.js','utf8'); const rn=fs.readFileSync('renderer.js','utf8'); let ok=true; if(mw.includes('ArrowLeft') && mw.includes('left') && /ArrowLeft.*left/.test(mw.split('before-input-event')[1]||'')) { console.log('FAIL: MainWindow still intercepts ArrowLeft'); ok=false; } if(!mw.includes('ctrl-tab')) { console.log('FAIL: MainWindow missing ctrl-tab send'); ok=false; } if(!pl.includes('onCtrlTab')) { console.log('FAIL: preload missing onCtrlTab'); ok=false; } if(!rn.includes('onCtrlTab')) { console.log('FAIL: renderer missing onCtrlTab listener'); ok=false; } if(ok) console.log('PASS: All three layers wired correctly');"</automated>
    <manual>In the app, press Ctrl+Tab — terminal tab should switch forward. Press Ctrl+Shift+Tab — should switch backward. Press Ctrl+Left/Right — should NOT switch tabs (will do nothing until plan 02-02 adds word-jump).</manual>
  </verify>
  <done>Ctrl+Tab/Ctrl+Shift+Tab forwarded from main process to renderer and wired to switchTerminal. Ctrl+Left/Right no longer intercepted in before-input-event.</done>
</task>

<task type="auto">
  <name>Task 2: Remove Ctrl+Left/Right tab-switch from createTerminalKeyHandler</name>
  <files>
    src/renderer/ui/components/TerminalManager.js
  </files>
  <action>
In `createTerminalKeyHandler` (around lines 531-558), find the block that checks for arrow keys and calls `callbacks.onSwitchTerminal('left')` / `callbacks.onSwitchTerminal('right')`.

Remove ONLY the `ArrowLeft` and `ArrowRight` branches that call `onSwitchTerminal`. Keep the `ArrowUp` and `ArrowDown` branches that call `onSwitchProject` — those still use Ctrl+Arrow for project switching.

The block currently looks like:
```js
if (e.ctrlKey && !e.shiftKey && !e.altKey && !e.repeat && e.type === 'keydown') {
  const isArrowKey = ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.key);
  if (isArrowKey) {
    // debounce...
    if (e.key === 'ArrowLeft' && callbacks.onSwitchTerminal) { ... return false; }
    if (e.key === 'ArrowRight' && callbacks.onSwitchTerminal) { ... return false; }
    if (e.key === 'ArrowUp' && callbacks.onSwitchProject) { ... }
    if (e.key === 'ArrowDown' && callbacks.onSwitchProject) { ... }
  }
}
```

After editing, the `isArrowKey` check should only include `['ArrowUp', 'ArrowDown']` and the Left/Right branches should be deleted entirely. (Plan 02-02 will add word-jump handling for Left/Right in a separate code path.)

Also search TerminalManager.js for any other references to `onSwitchTerminal` that might handle Ctrl+Left/Right and remove those tab-switching paths too (the `setupClipboardShortcuts` function should NOT be affected — it handles Ctrl+Shift+C/V, not Ctrl+Arrow).
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && node -e "const fs=require('fs'); const src=fs.readFileSync('src/renderer/ui/components/TerminalManager.js','utf8'); const handler=src.split('createTerminalKeyHandler')[1]||''; if(handler.includes('onSwitchTerminal')) { console.log('FAIL: onSwitchTerminal still referenced in createTerminalKeyHandler'); } else { console.log('PASS: Ctrl+Left/Right tab-switch removed from handler'); } if(!handler.includes('onSwitchProject')) { console.log('WARN: onSwitchProject also removed — should be kept for Up/Down'); }"</automated>
  </verify>
  <done>Ctrl+Left/Right no longer call onSwitchTerminal in createTerminalKeyHandler. Ctrl+Up/Down project switching preserved.</done>
</task>

</tasks>

<verification>
1. `grep -n "ctrl-tab" src/main/windows/MainWindow.js` — shows the new IPC send
2. `grep -n "onCtrlTab" src/main/preload.js` — shows the listener bridge
3. `grep -n "onCtrlTab" renderer.js` — shows the renderer wiring
4. `grep -n "onSwitchTerminal" src/renderer/ui/components/TerminalManager.js` — should NOT appear in createTerminalKeyHandler section
5. `grep -n "ArrowUp\|ArrowDown" src/renderer/ui/components/TerminalManager.js` — should still exist for project switching
6. `npm run build:renderer` succeeds without errors
</verification>

<success_criteria>
- Ctrl+Tab and Ctrl+Shift+Tab switch terminal tabs via the main process → IPC → renderer path
- Ctrl+Left and Ctrl+Right are no longer intercepted anywhere for tab-switching (both before-input-event and createTerminalKeyHandler)
- Ctrl+Up and Ctrl+Down project switching is unchanged
- Renderer builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/02-terminal-keyboard-shortcuts/02-01-SUMMARY.md`
</output>

---
phase: 02-terminal-keyboard-shortcuts
plan: 02
type: execute
wave: 2
depends_on:
  - "02-01"
files_modified:
  - src/renderer/ui/components/TerminalManager.js
autonomous: true
requirements:
  - TERM-01
  - TERM-02
  - TERM-03
must_haves:
  truths:
    - "Ctrl+C copies selected text to clipboard when terminal has a selection"
    - "Ctrl+C sends SIGINT to PTY when terminal has no selection"
    - "Ctrl+V pastes clipboard content into the terminal"
    - "Ctrl+Left jumps one word backward in the terminal"
    - "Ctrl+Right jumps one word forward in the terminal"
  artifacts:
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Ctrl+C selection-gated copy, Ctrl+V paste, Ctrl+Arrow word-jump in createTerminalKeyHandler"
      contains: "getSelection"
  key_links:
    - from: "createTerminalKeyHandler"
      to: "navigator.clipboard.writeText"
      via: "Ctrl+C when selection exists"
      pattern: "getSelection.*writeText"
    - from: "createTerminalKeyHandler"
      to: "api.terminal.input"
      via: "Ctrl+V paste and Ctrl+Arrow word-jump escape sequences"
      pattern: "terminal\\.input.*\\\\x1b"
---

<objective>
Add Ctrl+C selection-gated copy, Ctrl+V paste, and Ctrl+Left/Right word-jump to the xterm.js custom key event handler.

Purpose: Users expect standard Windows terminal keyboard shortcuts (copy, paste, word-jump) to work out of the box.
Output: Three new key handling branches in createTerminalKeyHandler.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-terminal-keyboard-shortcuts/02-RESEARCH.md
@.planning/phases/02-terminal-keyboard-shortcuts/02-01-SUMMARY.md
@src/renderer/ui/components/TerminalManager.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Ctrl+C copy, Ctrl+V paste, and Ctrl+Arrow word-jump to createTerminalKeyHandler</name>
  <files>
    src/renderer/ui/components/TerminalManager.js
  </files>
  <action>
In `createTerminalKeyHandler`, add three new key handling branches. These go inside the existing `if (e.ctrlKey && !e.shiftKey && !e.altKey && e.type === 'keydown')` block (or create one if plan 02-01 restructured it). Place them BEFORE the existing `return true` fallthrough.

**1. Ctrl+C — selection-gated copy (TERM-01):**

```js
if (e.key === 'c' || e.key === 'C') {
  const selection = terminal.getSelection();
  if (selection) {
    navigator.clipboard.writeText(selection)
      .catch(() => api.app.clipboardWrite(selection));
    return false; // suppress xterm — we handled the copy
  }
  return true; // no selection → let xterm send SIGINT to PTY
}
```

CRITICAL: The key comparison must match both `'c'` and `'C'` (Ctrl+C fires with key `'c'` on most systems, but some report `'C'`). Use `e.key.toLowerCase() === 'c'` or check both.

CRITICAL: When selection is empty/falsy, MUST return `true` so xterm sends SIGINT. This is how Ctrl+C interrupts running commands (like `sleep 10` or Claude CLI).

**2. Ctrl+V — paste (TERM-02):**

```js
if (e.key === 'v' || e.key === 'V') {
  const now = Date.now();
  if (now - lastPasteTime < PASTE_DEBOUNCE_MS) return false;
  lastPasteTime = now;

  const sendPaste = (text) => {
    if (!text) return;
    // Use the same inputChannel routing as existing paste handlers
    if (inputChannel === 'fivem-input') {
      api.fivem.input({ projectIndex: terminalId, data: text });
    } else if (inputChannel === 'webapp-input') {
      api.webapp.input({ projectIndex: terminalId, data: text });
    } else {
      api.terminal.input({ id: terminalId, data: text });
    }
  };

  navigator.clipboard.readText()
    .then(sendPaste)
    .catch(() => api.app.clipboardRead().then(sendPaste));
  return false;
}
```

Use the existing `lastPasteTime` and `PASTE_DEBOUNCE_MS` variables already defined in the module scope. Use the same `inputChannel` routing pattern as `setupPasteHandler` (check the existing code for the exact variable names and API calls — `inputChannel` is passed as a parameter to `createTerminalKeyHandler`).

**3. Ctrl+Left and Ctrl+Right — word-jump (TERM-03):**

```js
if (e.key === 'ArrowLeft') {
  // Word-jump backward — VT escape sequence for Ctrl+Left
  api.terminal.input({ id: terminalId, data: '\x1b[1;5D' });
  return false;
}
if (e.key === 'ArrowRight') {
  // Word-jump forward — VT escape sequence for Ctrl+Right
  api.terminal.input({ id: terminalId, data: '\x1b[1;5C' });
  return false;
}
```

For word-jump, use `api.terminal.input` directly (not the inputChannel routing). Word-jump escape sequences are terminal-specific and only make sense in real PTY terminals, not FiveM/WebApp consoles. If the terminal is a FiveM or WebApp console, Ctrl+Arrow should still fall through to default behavior (return true). Check `inputChannel` and only send escape sequences when it's the default `'terminal-input'` channel.

**Placement order within the Ctrl key block:** Ctrl+C first (most common), then Ctrl+V, then Ctrl+Arrow. This ensures the most frequently used shortcuts are checked first.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && node -e "const fs=require('fs'); const src=fs.readFileSync('src/renderer/ui/components/TerminalManager.js','utf8'); let ok=true; if(!src.includes('getSelection')) { console.log('FAIL: No getSelection call for Ctrl+C'); ok=false; } if(!src.includes('\\\\x1b[1;5D')) { console.log('FAIL: No word-left escape sequence'); ok=false; } if(!src.includes('\\\\x1b[1;5C')) { console.log('FAIL: No word-right escape sequence'); ok=false; } if(!src.includes('PASTE_DEBOUNCE_MS') || !src.includes('lastPasteTime')) { console.log('WARN: Paste debounce vars not found — check variable names'); } if(ok) console.log('PASS: All three shortcut branches present');"</automated>
    <manual>1. Open terminal, select some text, press Ctrl+C — text should be in clipboard. 2. With no selection, run `sleep 10`, press Ctrl+C — should interrupt. 3. Copy text, press Ctrl+V — should paste. 4. Type a command with multiple words, press Ctrl+Left/Right — cursor should jump by word.</manual>
  </verify>
  <done>Ctrl+C copies selection or sends SIGINT (no selection). Ctrl+V pastes with debounce and inputChannel routing. Ctrl+Left/Right sends word-jump escape sequences to PTY.</done>
</task>

</tasks>

<verification>
1. `grep -n "getSelection" src/renderer/ui/components/TerminalManager.js` — shows Ctrl+C selection check in createTerminalKeyHandler
2. `grep -n "1;5D\|1;5C" src/renderer/ui/components/TerminalManager.js` — shows word-jump escape sequences
3. `grep -n "clipboardRead\|clipboardWrite" src/renderer/ui/components/TerminalManager.js` — shows clipboard fallback paths
4. `npm run build:renderer` succeeds
5. `npm test` passes (existing tests should not break)
</verification>

<success_criteria>
- Ctrl+C with selection copies text; Ctrl+C without selection sends SIGINT (does not break Claude CLI interrupt)
- Ctrl+V pastes clipboard content via the correct inputChannel for the terminal type
- Ctrl+Left sends `\x1b[1;5D` (word-left) to PTY
- Ctrl+Right sends `\x1b[1;5C` (word-right) to PTY
- Paste debounce prevents double-paste
- Renderer builds and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-terminal-keyboard-shortcuts/02-02-SUMMARY.md`
</output>

---
phase: 03-new-terminal-button
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - renderer.js
  - styles/terminal.css
autonomous: true
requirements:
  - TMGR-01

must_haves:
  truths:
    - "A '+' button is visible after the project name, above the terminal tab strip, when a project is selected"
    - "Clicking the '+' button opens a new terminal tab identical to Ctrl+T"
    - "The button is hidden when no project is selected (inherits terminals-filter visibility)"
    - "The button works across all project types (general, FiveM, WebApp, Python)"
  artifacts:
    - path: "index.html"
      provides: "Button element inside terminals-filter div"
      contains: "btn-new-terminal"
    - path: "renderer.js"
      provides: "Click handler wiring for btn-new-terminal"
      contains: "btn-new-terminal"
    - path: "styles/terminal.css"
      provides: "Styling for .filter-new-terminal-btn"
      contains: "filter-new-terminal-btn"
  key_links:
    - from: "renderer.js"
      to: "index.html"
      via: "getElementById('btn-new-terminal')"
      pattern: "getElementById\\(['\"]btn-new-terminal['\"]\\)"
    - from: "renderer.js"
      to: "createTerminalForProject"
      via: "onclick handler calls createTerminalForProject(project)"
      pattern: "createTerminalForProject\\(projects\\["
---

<objective>
Add a visible "+" button after the project name badge inside the `terminals-filter` div, wired to the existing `createTerminalForProject()` flow, and styled as a compact icon button matching the existing filter controls.

Purpose: Users can create a new terminal with one click instead of relying on Ctrl+T keyboard shortcut.
Output: Button in HTML, click handler in renderer.js, CSS styles in terminal.css.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-new-terminal-button/03-RESEARCH.md
@index.html (lines 270-330 — terminals-filter div)
@renderer.js (lines 872-877 — createTerminalForProject; lines 1426-1429 — button wiring area; lines 2990-2999 — tray new-terminal pattern)
@styles/terminal.css (lines 56-105 — terminals-filter section)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "+" button HTML and CSS</name>
  <files>index.html, styles/terminal.css</files>
  <action>
In `index.html`, inside the `terminals-filter` div (around line 276), insert a button element IMMEDIATELY AFTER the `<span class="filter-project" id="filter-project-name"></span>` and BEFORE the `<div class="filter-git-actions"` div:

```html
<button class="filter-new-terminal-btn" id="btn-new-terminal" title="New terminal (Ctrl+T)">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="12" y1="5" x2="12" y2="19"/>
    <line x1="5" y1="12" x2="19" y2="12"/>
  </svg>
</button>
```

In `styles/terminal.css`, add the following CSS rules in the `terminals-filter` section (after the `.filter-project` rules, before `.filter-git-actions` rules):

```css
.filter-new-terminal-btn {
  width: 22px;
  height: 22px;
  padding: 0;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
  flex-shrink: 0;
}

.filter-new-terminal-btn:hover {
  background: var(--accent-dim);
  color: var(--accent);
}

.filter-new-terminal-btn svg {
  width: 14px;
  height: 14px;
}
```

IMPORTANT: Do NOT place the button outside `terminals-filter` — it must inherit the show/hide behavior. Do NOT put it after `filter-git-actions` — that would break the right-alignment (filter-git-actions has `margin-left: auto`).
  </action>
  <verify>
    <automated>grep -c "btn-new-terminal" index.html && grep -c "filter-new-terminal-btn" styles/terminal.css</automated>
    <manual>Open index.html and verify the button is between filter-project span and filter-git-actions div</manual>
  </verify>
  <done>Button element exists in index.html inside terminals-filter after project name span; CSS rules exist in terminal.css for .filter-new-terminal-btn with hover state and SVG sizing</done>
</task>

<task type="auto">
  <name>Task 2: Wire click handler in renderer.js</name>
  <files>renderer.js</files>
  <action>
In `renderer.js`, near the button wiring section (around line 1426, where `btn-toggle-explorer` is wired), add the click handler for the new terminal button:

```javascript
// Wire "+" new terminal button
const btnNewTerminal = document.getElementById('btn-new-terminal');
if (btnNewTerminal) {
  btnNewTerminal.onclick = () => {
    const selectedFilter = projectsState.get().selectedProjectFilter;
    const projects = projectsState.get().projects;
    if (selectedFilter !== null && projects[selectedFilter]) {
      createTerminalForProject(projects[selectedFilter]);
    }
  };
}
```

This follows the exact same pattern as the tray's `onOpenTerminal` handler (line 2990) but simplified — no fallback to `projects[0]` needed because the button is only visible when a project IS selected (it lives inside `terminals-filter` which is hidden otherwise).

IMPORTANT: Call `createTerminalForProject()` (NOT `TerminalManager.createTerminal()` directly) — it handles `skipPermissions` from settings state. The `projectsState` variable is already in scope at the wiring location.
  </action>
  <verify>
    <automated>grep -c "btn-new-terminal" renderer.js && grep "createTerminalForProject" renderer.js | grep -c "btnNewTerminal\|btn-new-terminal"</automated>
    <manual>N/A</manual>
  </verify>
  <done>Click handler wired for btn-new-terminal in renderer.js; handler calls createTerminalForProject with the currently selected project from projectsState</done>
</task>

</tasks>

<verification>
1. `grep -c "btn-new-terminal" index.html` returns at least 1 (button element exists)
2. `grep -c "filter-new-terminal-btn" styles/terminal.css` returns at least 3 (base, hover, svg rules)
3. `grep -c "btn-new-terminal" renderer.js` returns at least 1 (handler wired)
4. `grep "createTerminalForProject" renderer.js | grep -c "btnNewTerminal\|btn-new-terminal"` returns 1 (correct function called)
5. Button is inside `terminals-filter` div (between filter-project span and filter-git-actions div)
</verification>

<success_criteria>
- A "+" button appears in the terminals-filter bar after the project name when a project is selected
- Clicking the button creates a new terminal for the selected project (same behavior as Ctrl+T)
- Button is automatically hidden when no project is selected (inherits terminals-filter display:none)
- Button styling matches the compact icon-button pattern used by other controls in the filter bar
- Git action buttons remain right-aligned (filter-git-actions margin-left:auto not broken)
</success_criteria>

<output>
After completion, create `.planning/phases/03-new-terminal-button/03-01-SUMMARY.md`
</output>

---
phase: 1.1-dotfile-visibility-setting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/state/settings.state.js
  - src/renderer/ui/components/FileExplorer.js
  - src/renderer/ui/panels/SettingsPanel.js
  - src/renderer/i18n/locales/en.json
  - src/renderer/i18n/locales/fr.json
autonomous: true
requirements: [FILE-01, FILE-02]

must_haves:
  truths:
    - "User sees an Explorer group in General settings with a Show dotfiles toggle (enabled by default)"
    - "Toggling Show dotfiles OFF hides files/folders starting with a dot in the file explorer tree"
    - "Toggling Show dotfiles OFF hides dotfiles from the file search/indexer results"
    - "Existing users who upgrade see dotfiles by default (no behavior change until they toggle)"
    - "Toggle takes effect immediately on next folder expand or search — no project reload needed"
  artifacts:
    - path: "src/renderer/state/settings.state.js"
      provides: "showDotfiles default setting"
      contains: "showDotfiles"
    - path: "src/renderer/ui/components/FileExplorer.js"
      provides: "Dotfile filter in tree and search"
      contains: "showDotfiles"
    - path: "src/renderer/ui/panels/SettingsPanel.js"
      provides: "Explorer group with toggle UI and save handler"
      contains: "show-dotfiles-toggle"
    - path: "src/renderer/i18n/locales/en.json"
      provides: "English i18n keys for Explorer group"
      contains: "explorerGroup"
    - path: "src/renderer/i18n/locales/fr.json"
      provides: "French i18n keys for Explorer group"
      contains: "explorerGroup"
  key_links:
    - from: "src/renderer/ui/panels/SettingsPanel.js"
      to: "src/renderer/state/settings.state.js"
      via: "saveSettingsHandler persists showDotfiles"
      pattern: "showDotfiles.*newSettings|newSettings.*showDotfiles"
    - from: "src/renderer/ui/components/FileExplorer.js"
      to: "src/renderer/state/settings.state.js"
      via: "getSetting('showDotfiles') call-time read"
      pattern: "getSetting.*showDotfiles"
---

<objective>
Add a configurable dotfile visibility toggle in Settings so users can show or hide files/folders starting with a dot in the file explorer. The toggle defaults to enabled (show dotfiles) preserving Phase 1's behavior, but gives users control to hide them if desired.

Purpose: Phase 1 removed the hard-coded dotfile filter entirely. Some users may want dotfiles hidden. This re-introduces the filter as an opt-out setting rather than a hard-coded rule.
Output: showDotfiles setting key, Explorer group in General settings with toggle, dotfile filtering in both FileExplorer code paths, EN+FR i18n keys.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/1.1-dotfile-visibility-setting/1.1-RESEARCH.md
@src/renderer/state/settings.state.js
@src/renderer/ui/components/FileExplorer.js
@src/renderer/ui/panels/SettingsPanel.js
@src/renderer/i18n/locales/en.json
@src/renderer/i18n/locales/fr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add showDotfiles setting, Explorer toggle UI, i18n keys, and save handler</name>
  <files>
    src/renderer/state/settings.state.js
    src/renderer/ui/panels/SettingsPanel.js
    src/renderer/i18n/locales/en.json
    src/renderer/i18n/locales/fr.json
  </files>
  <action>
1. **settings.state.js** — Add `showDotfiles: true` to the `defaultSettings` object (alongside the other boolean defaults like `compactProjects`, `terminalContextMenu`, etc.).

2. **en.json** — Add three keys under the `"settings"` object:
   ```json
   "explorerGroup": "Explorer",
   "showDotfiles": "Show dotfiles",
   "showDotfilesDesc": "Show hidden files and folders (starting with a dot) in the file explorer"
   ```

3. **fr.json** — Add same three keys under `"settings"`:
   ```json
   "explorerGroup": "Explorateur",
   "showDotfiles": "Afficher les dotfiles",
   "showDotfilesDesc": "Afficher les fichiers et dossiers cachés (commençant par un point) dans l'explorateur de fichiers"
   ```

4. **SettingsPanel.js** — In the General tab HTML template (inside `renderSettingsTab`), insert a new Explorer group after the System group and before Quick Action Presets. Use the exact established pattern:
   ```html
   <div class="settings-group">
     <div class="settings-group-title">${t('settings.explorerGroup')}</div>
     <div class="settings-card">
       <div class="settings-toggle-row">
         <div class="settings-toggle-label">
           <div>${t('settings.showDotfiles')}</div>
           <div class="settings-toggle-desc">${t('settings.showDotfilesDesc')}</div>
         </div>
         <label class="settings-toggle">
           <input type="checkbox" id="show-dotfiles-toggle" ${settings.showDotfiles !== false ? 'checked' : ''}>
           <span class="settings-toggle-slider"></span>
         </label>
       </div>
     </div>
   </div>
   ```
   IMPORTANT: Use `!== false` pattern (not `=== true`) so undefined/missing defaults to enabled.

5. **SettingsPanel.js** — In `saveSettingsHandler`, read the toggle and add to `newSettings`:
   ```js
   const showDotfilesToggle = document.getElementById('show-dotfiles-toggle');
   const newShowDotfiles = showDotfilesToggle ? showDotfilesToggle.checked : true;
   ```
   Then add `showDotfiles: newShowDotfiles` to the `newSettings` object.
  </action>
  <verify>
    <automated>grep -c "showDotfiles" src/renderer/state/settings.state.js src/renderer/ui/panels/SettingsPanel.js src/renderer/i18n/locales/en.json src/renderer/i18n/locales/fr.json</automated>
    <manual>Each file should have at least 1 occurrence of showDotfiles</manual>
  </verify>
  <done>showDotfiles key exists in defaultSettings; Explorer group renders in General settings tab with a toggle defaulting to checked; saveSettingsHandler persists the toggle value; EN and FR i18n keys exist for explorerGroup, showDotfiles, showDotfilesDesc</done>
</task>

<task type="auto">
  <name>Task 2: Add dotfile filter to FileExplorer tree and search paths, build renderer</name>
  <files>
    src/renderer/ui/components/FileExplorer.js
  </files>
  <action>
1. **FileExplorer.js — readDirectoryAsync** — Inside the function body (NOT at module level), add a lazy require and call-time read of the setting. Place the dotfile skip immediately after the `IGNORE_PATTERNS.has(name)` continue inside the `for (const name of names)` loop:
   ```js
   // At top of function body (inside readDirectoryAsync, before the loop):
   const { getSetting } = require('../../state/settings.state');
   const showDotfiles = getSetting('showDotfiles');

   // Inside the for loop, after IGNORE_PATTERNS check:
   if (showDotfiles === false && name.startsWith('.')) continue;
   ```
   Use `=== false` (not `!showDotfiles`) to be safe with undefined — undefined means show dotfiles (default behavior).

2. **FileExplorer.js — collectAllFiles** — Same pattern. Inside the function body, lazy-require `getSetting`, read `showDotfiles` once, then inside the `for (const name of names)` loop after the `IGNORE_PATTERNS.has(name)` continue:
   ```js
   // At top of function body (inside collectAllFiles, before the while loop):
   const { getSetting } = require('../../state/settings.state');
   const showDotfiles = getSetting('showDotfiles');

   // Inside the for loop, after IGNORE_PATTERNS check:
   if (showDotfiles === false && name.startsWith('.')) continue;
   ```

3. **Build** — Run `npm run build:renderer` to produce updated `dist/renderer.bundle.js`.
  </action>
  <verify>
    <automated>grep -c "getSetting.*showDotfiles\|showDotfiles.*getSetting" src/renderer/ui/components/FileExplorer.js && npm run build:renderer</automated>
    <manual>FileExplorer.js should have 2 occurrences (one per function); build should succeed without errors</manual>
  </verify>
  <done>readDirectoryAsync filters dotfiles when showDotfiles is false; collectAllFiles filters dotfiles when showDotfiles is false; both use lazy-require and call-time read pattern; renderer bundle builds successfully</done>
</task>

</tasks>

<verification>
1. `grep -r "showDotfiles" src/renderer/` should show hits in settings.state.js, SettingsPanel.js, FileExplorer.js
2. `grep "explorerGroup" src/renderer/i18n/locales/en.json src/renderer/i18n/locales/fr.json` shows hits in both locale files
3. `grep "show-dotfiles-toggle" src/renderer/ui/panels/SettingsPanel.js` shows hits in both HTML template and saveSettingsHandler
4. `npm run build:renderer` succeeds
5. `npm test` passes (no regressions)
</verification>

<success_criteria>
- showDotfiles: true exists in defaultSettings
- Explorer group with toggle renders in General settings (HTML contains settings-group with explorerGroup title)
- saveSettingsHandler reads show-dotfiles-toggle and persists showDotfiles
- readDirectoryAsync skips dotfiles when showDotfiles === false
- collectAllFiles skips dotfiles when showDotfiles === false
- EN and FR locale files contain explorerGroup, showDotfiles, showDotfilesDesc
- Renderer bundle builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/1.1-dotfile-visibility-setting/1.1-01-SUMMARY.md`
</output>

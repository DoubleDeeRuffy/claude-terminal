---
phase: 10-adjust-tab-renaming
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/events/index.js
  - src/renderer/state/settings.state.js
  - src/renderer/ui/panels/SettingsPanel.js
  - src/renderer/i18n/locales/en.json
  - src/renderer/i18n/locales/fr.json
autonomous: true
requirements:
  - TAB-RENAME-01
must_haves:
  truths:
    - "When tabRenameOnSlashCommand is enabled and a slash command is submitted in a hooks-enabled terminal, the tab renames to the full slash command text"
    - "Regular (non-slash) prompts do not trigger a tab rename"
    - "The tab name persists through /clear — only a new slash command replaces it"
    - "When the setting is OFF, tabs use the existing haiku AI-generated naming behavior"
    - "A new Settings toggle for tab rename on slash command appears in the Terminal Settings section"
    - "The setting takes effect immediately without page reload"
  artifacts:
    - path: "src/renderer/events/index.js"
      provides: "wireTabRenameConsumer function wired into initClaudeEvents"
      contains: "wireTabRenameConsumer"
    - path: "src/renderer/state/settings.state.js"
      provides: "tabRenameOnSlashCommand default setting"
      contains: "tabRenameOnSlashCommand"
    - path: "src/renderer/ui/panels/SettingsPanel.js"
      provides: "Toggle UI for tabRenameOnSlashCommand"
      contains: "tab-rename-slash-toggle"
    - path: "src/renderer/i18n/locales/en.json"
      provides: "English i18n keys for the setting"
      contains: "tabRenameOnSlashCommand"
    - path: "src/renderer/i18n/locales/fr.json"
      provides: "French i18n keys for the setting"
      contains: "tabRenameOnSlashCommand"
  key_links:
    - from: "src/renderer/events/index.js"
      to: "ClaudeEventBus PROMPT_SUBMIT"
      via: "eventBus.on(EVENT_TYPES.PROMPT_SUBMIT, ...)"
      pattern: "EVENT_TYPES\\.PROMPT_SUBMIT"
    - from: "src/renderer/events/index.js"
      to: "TerminalManager.updateTerminalTabName"
      via: "lazy require inside callback"
      pattern: "updateTerminalTabName"
    - from: "src/renderer/events/index.js"
      to: "settings.state getSetting"
      via: "runtime getSetting('tabRenameOnSlashCommand') call inside event handler"
      pattern: "getSetting.*tabRenameOnSlashCommand"
---

<objective>
Add opt-in tab auto-renaming to the last slash command executed in a terminal session. When enabled, PROMPT_SUBMIT events from HooksProvider detect slash commands (starting with `/`) and rename the active terminal tab to the full command text. Includes a settings toggle in Terminal Settings and i18n for EN/FR.

Purpose: Users who use slash commands (e.g., `/gsd:verify-work 12`) can instantly see which command is running in each tab without reading terminal output.
Output: wireTabRenameConsumer in events/index.js, setting key + default, toggle UI, i18n keys.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-adjust-tab-renaming/10-RESEARCH.md

@src/renderer/events/index.js
@src/renderer/state/settings.state.js
@src/renderer/ui/panels/SettingsPanel.js
@src/renderer/i18n/locales/en.json
@src/renderer/i18n/locales/fr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wireTabRenameConsumer and setting default</name>
  <files>
    src/renderer/events/index.js
    src/renderer/state/settings.state.js
  </files>
  <action>
**In `src/renderer/state/settings.state.js`:**
Add `tabRenameOnSlashCommand: false` to the `defaultSettings` object. Place it after the last existing key (near `updateTitleOnProjectSwitch` or similar). This is opt-in — default OFF preserves existing haiku naming behavior.

**In `src/renderer/events/index.js`:**
1. Add a new `wireTabRenameConsumer()` function following the exact pattern of `wireTerminalStatusConsumer()` and `wireSessionIdCapture()`:

```js
function wireTabRenameConsumer() {
  const MAX_TAB_NAME_LEN = 40;
  consumerUnsubscribers.push(
    eventBus.on(EVENT_TYPES.PROMPT_SUBMIT, (e) => {
      if (e.source !== 'hooks') return;
      if (!e.projectId) return;
      const prompt = e.data?.prompt;
      if (!prompt || !prompt.trimStart().startsWith('/')) return;
      const { getSetting } = require('../state/settings.state');
      if (!getSetting('tabRenameOnSlashCommand')) return;
      const terminalId = findClaudeTerminalForProject(e.projectId);
      if (!terminalId) return;
      const name = prompt.length > MAX_TAB_NAME_LEN
        ? prompt.slice(0, MAX_TAB_NAME_LEN - 1) + '\u2026'
        : prompt;
      try {
        const TerminalManager = require('../ui/components/TerminalManager');
        TerminalManager.updateTerminalTabName(terminalId, name);
      } catch (err) { /* TerminalManager not ready */ }
    })
  );
}
```

Key implementation details:
- Guard `e.source !== 'hooks'` — ScrapingProvider emits `prompt: null`, only HooksProvider has the text
- Guard `!prompt.trimStart().startsWith('/')` — only slash commands trigger rename
- Use `getSetting()` inside the callback (not cached) so toggling takes effect immediately per Phase 7 decision pattern
- Use lazy `require('../ui/components/TerminalManager')` inside the callback to avoid circular dependency (Phase 4/5/6 established pattern)
- Truncate at 40 chars with Unicode ellipsis `\u2026`
- Use existing `findClaudeTerminalForProject(e.projectId)` to resolve terminal ID

2. Call `wireTabRenameConsumer()` from `initClaudeEvents()`, placing it after `wireSessionIdCapture()` and before `wireDebugListener()`.

Do NOT touch `extractTitleFromInput()` in TerminalManager — it already skips slash commands.
Do NOT add any /clear reset logic — per user decision, tab name persists through /clear.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && npm run build:renderer 2>&1 | tail -5</automated>
    <manual>Verify wireTabRenameConsumer exists in events/index.js and tabRenameOnSlashCommand exists in settings.state.js</manual>
  </verify>
  <done>wireTabRenameConsumer is wired into initClaudeEvents, listens for PROMPT_SUBMIT with slash commands, and renames the tab via updateTerminalTabName. Setting key defaults to false.</done>
</task>

<task type="auto">
  <name>Task 2: Add settings toggle UI and i18n keys</name>
  <files>
    src/renderer/ui/panels/SettingsPanel.js
    src/renderer/i18n/locales/en.json
    src/renderer/i18n/locales/fr.json
  </files>
  <action>
**In `src/renderer/ui/panels/SettingsPanel.js`:**
1. In the Terminal Settings section HTML (after the `terminal-context-menu-toggle` or the last toggle in that section), add:

```html
<div class="settings-toggle-row">
  <div class="settings-toggle-label">
    <div>${t('settings.tabRenameOnSlashCommand')}</div>
    <div class="settings-toggle-desc">${t('settings.tabRenameOnSlashCommandDesc')}</div>
  </div>
  <label class="settings-toggle">
    <input type="checkbox" id="tab-rename-slash-toggle" ${settings.tabRenameOnSlashCommand ? 'checked' : ''}>
    <span class="settings-toggle-slider"></span>
  </label>
</div>
```

2. In `saveSettingsHandler()`, read the new toggle value:
```js
const tabRenameSlashToggle = document.getElementById('tab-rename-slash-toggle');
const newTabRenameOnSlashCommand = tabRenameSlashToggle ? tabRenameSlashToggle.checked : false;
```
Add `tabRenameOnSlashCommand: newTabRenameOnSlashCommand` to the `newSettings` object.

Note: The existing `autoSave` listener (`container.querySelectorAll('.settings-toggle input, .settings-select').forEach(el => el.addEventListener('change', autoSave))`) automatically covers the new checkbox — no extra event wiring needed.

**In `src/renderer/i18n/locales/en.json`:**
Add these keys in the `settings` section, after the `updateTitleOnProjectSwitchDesc` key:
```json
"tabRenameOnSlashCommand": "Rename tab on slash command",
"tabRenameOnSlashCommandDesc": "Automatically rename the terminal tab to the last slash command executed (e.g. /gsd:verify-work 12)"
```

**In `src/renderer/i18n/locales/fr.json`:**
Add corresponding keys after `updateTitleOnProjectSwitchDesc`:
```json
"tabRenameOnSlashCommand": "Renommer l'onglet sur commande slash",
"tabRenameOnSlashCommandDesc": "Renomme automatiquement l'onglet terminal avec la dernière commande slash exécutée (ex. /gsd:verify-work 12)"
```
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && npm run build:renderer 2>&1 | tail -5</automated>
    <manual>Verify tab-rename-slash-toggle checkbox appears in SettingsPanel HTML and i18n keys exist in both locale files</manual>
  </verify>
  <done>Settings toggle for tabRenameOnSlashCommand appears in Terminal Settings section. Toggle reads/saves correctly. EN and FR i18n keys are present.</done>
</task>

</tasks>

<verification>
1. `npm run build:renderer` completes without errors
2. `grep -c "wireTabRenameConsumer" src/renderer/events/index.js` returns 2+ (definition + call in initClaudeEvents)
3. `grep -c "tabRenameOnSlashCommand" src/renderer/state/settings.state.js` returns 1+
4. `grep -c "tab-rename-slash-toggle" src/renderer/ui/panels/SettingsPanel.js` returns 2+ (HTML + saveHandler)
5. `grep -c "tabRenameOnSlashCommand" src/renderer/i18n/locales/en.json` returns 2
6. `grep -c "tabRenameOnSlashCommand" src/renderer/i18n/locales/fr.json` returns 2
</verification>

<success_criteria>
- wireTabRenameConsumer listens for PROMPT_SUBMIT events with slash commands and renames tabs
- Setting `tabRenameOnSlashCommand` defaults to false (opt-in)
- Settings UI toggle is visible and functional in Terminal Settings section
- EN and FR translations are present
- Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-adjust-tab-renaming/10-01-SUMMARY.md`
</output>

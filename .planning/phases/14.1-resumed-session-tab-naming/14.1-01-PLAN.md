---
phase: 14.1-resumed-session-tab-naming
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/ui/components/TerminalManager.js
autonomous: true
requirements:
  - SESS-RESUME-01
  - TAB-RESUME-01

must_haves:
  truths:
    - "When user clicks a session card in the resume dialog that has a custom name (haiku AI, slash command, or manual rename), the new tab displays that exact name"
    - "When user clicks a session card with no custom name (isRenamed=false), the tab shows 'Resume...' interim text then gets default naming behavior"
    - "Tab name set from resume dialog can be overridden by manual rename (standard behavior unchanged)"
  artifacts:
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Session name threading from resume dialog card click through resumeSession to tab creation"
      contains: "sessionName"
  key_links:
    - from: "renderSessionsPanel card click handler"
      to: "resumeSession options"
      via: "sessionMap.get(sessionId).displayTitle when isRenamed"
      pattern: "session\\.isRenamed.*displayTitle"
    - from: "resumeSession"
      to: "terminal-mode termData.name and tab DOM"
      via: "name option destructured from options"
      pattern: "sessionName.*terminals\\.resuming"
    - from: "resumeSession"
      to: "createChatTerminal"
      via: "name option passed through"
      pattern: "createChatTerminal.*name.*sessionName"
---

<objective>
Thread the saved session name from the resume dialog through to the tab name when resuming a Claude session.

Purpose: When a user resumes a session via the resume dialog (Phase 14), the tab should display the session's original name (set by haiku AI, slash command, or manual rename) instead of staying as "Resume..." indefinitely.

Output: Modified TerminalManager.js with name threading from card click → resumeSession → tab creation (both terminal and chat modes).
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14.1-resumed-session-tab-naming/14.1-RESEARCH.md

@src/renderer/ui/components/TerminalManager.js

<interfaces>
<!-- Key patterns and contracts the executor needs from TerminalManager.js -->

From renderSessionsPanel — sessionMap contains preprocessed session data:
```javascript
// preprocessSessions returns array of:
// { sessionId, displayTitle, isRenamed, customName, summary, lastMessage, ... }
// sessionMap = new Map(sessionId → processedSession)
```

From resumeSession signature (current):
```javascript
async function resumeSession(project, sessionId, options = {}) {
  const { skipPermissions = false } = options;
  // ... terminal mode: builds termData inline with name: t('terminals.resuming')
  // ... chat mode: calls createChatTerminal(project, { skipPermissions, resumeSessionId })
}
```

From createChatTerminal — already accepts name option:
```javascript
async function createChatTerminal(project, options = {}) {
  const { skipPermissions = false, name: customName = null, resumeSessionId = null, ... } = options;
  const tabName = customName || project.name;
  // tabName used for both termData.name and DOM tab text
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Thread session name from card click to resumeSession</name>
  <files>src/renderer/ui/components/TerminalManager.js</files>
  <action>
In `renderSessionsPanel`, find the card click handler where `resumeSession` is called. It currently passes `{ skipPermissions }` only.

**Change the card click handler** to extract the session name from `sessionMap`:

```javascript
const session = sessionMap.get(sessionId);
// Only pass name if it was explicitly set (haiku AI, slash command, or manual rename)
// per CONTEXT.md: "If the original tab had no custom name, keep default as-is"
const sessionName = (session?.isRenamed && session?.displayTitle) ? session.displayTitle : null;
resumeSession(project, sessionId, { skipPermissions, name: sessionName });
```

The `isRenamed` guard ensures only explicitly-set names (from `getSessionCustomName` / haiku AI / slash command / manual rename) are forwarded. Sessions with auto-derived titles from summary/prompt snippets get `null` (falls back to "Resume..." then normal naming behavior).

**Update `resumeSession` signature** to destructure the new `name` option:

```javascript
async function resumeSession(project, sessionId, options = {}) {
  const { skipPermissions = false, name: sessionName = null } = options;
```

This task only changes the click handler and the function signature. Task 2 handles using the name in tab creation.
  </action>
  <verify>
    <automated>cd /c/Users/uhgde/source/repos/claude-terminal && grep -n "sessionName" src/renderer/ui/components/TerminalManager.js | head -10</automated>
  </verify>
  <done>Card click handler extracts displayTitle (guarded by isRenamed) from sessionMap and passes it as `name` option to resumeSession. resumeSession destructures `name: sessionName` from options.</done>
</task>

<task type="auto">
  <name>Task 2: Apply session name to tab creation in both terminal and chat modes</name>
  <files>src/renderer/ui/components/TerminalManager.js</files>
  <action>
Inside `resumeSession`, apply the `sessionName` to both code paths:

**Terminal mode (inline tab creation):**

Find the `termData` object where `name: t('terminals.resuming')` is set. Change to:
```javascript
name: sessionName || t('terminals.resuming'),
```

Find the tab innerHTML where `<span class="tab-name">${escapeHtml(t('terminals.resuming'))}</span>` appears. Change to:
```javascript
<span class="tab-name">${escapeHtml(sessionName || t('terminals.resuming'))}</span>
```

Both locations must use `sessionName || t('terminals.resuming')` so that:
- If sessionName is truthy → shows the saved name immediately (Phase 16 pattern)
- If sessionName is null → falls back to "Resume..." (existing behavior preserved)

**Chat mode (createChatTerminal call):**

Find the `createChatTerminal` call inside `resumeSession`. It currently passes `{ skipPermissions, resumeSessionId }`. Add `name: sessionName`:
```javascript
return createChatTerminal(project, { skipPermissions, resumeSessionId: sessionId, name: sessionName });
```

`createChatTerminal` already handles `name` via `customName` destructuring — when non-null it uses the name as `tabName`, when null it falls back to `project.name`. No changes needed inside `createChatTerminal`.

**No persistence changes needed** — session-names.json already has the name (Phase 10.1). The tab name will be saved through normal `saveTerminalSessions` flow on subsequent mutations.
  </action>
  <verify>
    <automated>cd /c/Users/uhgde/source/repos/claude-terminal && grep -c "sessionName || t(" src/renderer/ui/components/TerminalManager.js</automated>
  </verify>
  <done>Terminal-mode tab creation uses `sessionName || t('terminals.resuming')` for both termData.name and tab DOM text. Chat-mode createChatTerminal call passes `name: sessionName`. When a resumed session has a custom name, the tab displays it immediately; otherwise falls back to existing behavior.</done>
</task>

</tasks>

<verification>
1. `grep -n "sessionName" src/renderer/ui/components/TerminalManager.js` — should show: sessionMap extraction, destructuring in resumeSession, termData.name usage, tab innerHTML usage, createChatTerminal call
2. `grep -n "session\\.isRenamed" src/renderer/ui/components/TerminalManager.js` — should show the guard in card click handler
3. `npm run build:renderer` — builds without errors
4. `npm test` — all tests pass
</verification>

<success_criteria>
- Clicking a renamed session card in the resume dialog creates a tab with that session's saved name
- Clicking an un-renamed session card creates a tab with "Resume..." text (existing behavior)
- Chat-mode resume passes the name to createChatTerminal
- Build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-resumed-session-tab-naming/14.1-01-SUMMARY.md`
</output>

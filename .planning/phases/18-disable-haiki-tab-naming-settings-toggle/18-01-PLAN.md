---
phase: 18-disable-haiki-tab-naming-settings-toggle
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/state/settings.state.js
  - src/renderer/ui/components/ChatView.js
  - src/renderer/ui/components/TerminalManager.js
  - src/renderer/ui/panels/SettingsPanel.js
  - src/renderer/i18n/locales/en.json
  - src/renderer/i18n/locales/fr.json
autonomous: true
requirements:
  - TAB-NAME-01
must_haves:
  truths:
    - "When aiTabNaming is OFF, chat-mode tabs keep their default name (no truncation rename, no haiku AI rename)"
    - "When aiTabNaming is OFF, terminal-mode tabs are not renamed by OSC title changes from Claude CLI"
    - "When aiTabNaming is ON (default), all existing tab naming behavior works exactly as before"
    - "A new Tabs settings group appears in the settings panel with both the AI tab naming toggle and the moved slash-command rename toggle"
    - "Existing users upgrading see no behavior change (aiTabNaming defaults to true)"
  artifacts:
    - path: "src/renderer/state/settings.state.js"
      provides: "aiTabNaming default"
      contains: "aiTabNaming: true"
    - path: "src/renderer/ui/components/ChatView.js"
      provides: "Guard on both generateTabName call sites"
      contains: "aiTabNaming"
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Guard on both OSC rename call sites"
      contains: "aiTabNaming"
    - path: "src/renderer/ui/panels/SettingsPanel.js"
      provides: "New Tabs group with AI tab naming toggle and moved slash-command toggle"
      contains: "ai-tab-naming-toggle"
  key_links:
    - from: "src/renderer/ui/panels/SettingsPanel.js"
      to: "src/renderer/state/settings.state.js"
      via: "collectSettings reads checkbox, saves aiTabNaming"
      pattern: "aiTabNaming"
    - from: "src/renderer/ui/components/ChatView.js"
      to: "src/renderer/state/settings.state.js"
      via: "getSetting('aiTabNaming') call-time read"
      pattern: "getSetting.*aiTabNaming"
    - from: "src/renderer/ui/components/TerminalManager.js"
      to: "src/renderer/state/settings.state.js"
      via: "getSetting('aiTabNaming') call-time read"
      pattern: "getSetting.*aiTabNaming"
---

<objective>
Add an "AI tab naming" settings toggle that controls whether tabs are automatically renamed by the haiku AI model (chat mode) and by OSC title changes from Claude CLI (terminal mode). Create a new Tabs settings group and relocate the existing slash-command rename toggle into it.

Purpose: Users who prefer static tab names can disable the automatic AI-powered renaming that fires on every message/task change.
Output: Setting toggle in new Tabs group, guards on all 4 rename call sites (2 in ChatView, 2 in TerminalManager), i18n in EN+FR.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-disable-haiki-tab-naming-settings-toggle/18-RESEARCH.md

@src/renderer/state/settings.state.js
@src/renderer/ui/components/ChatView.js
@src/renderer/ui/components/TerminalManager.js
@src/renderer/ui/panels/SettingsPanel.js
@src/renderer/i18n/locales/en.json
@src/renderer/i18n/locales/fr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aiTabNaming setting default and guard all rename call sites</name>
  <files>
    src/renderer/state/settings.state.js
    src/renderer/ui/components/ChatView.js
    src/renderer/ui/components/TerminalManager.js
  </files>
  <action>
    **settings.state.js:** Add `aiTabNaming: true` to the `defaultSettings` object, alongside the existing boolean settings.

    **ChatView.js:** There are two `generateTabName` call sites (one for keyboard-submitted messages ~line 1527-1538, one for remote/PWA messages ~line 3196-3206). Both follow this pattern:
    ```js
    if (onTabRename && !text.startsWith('/')) {
      // immediate truncation rename
      // async haiku AI rename
    }
    ```
    Add `getSetting('aiTabNaming') !== false` to the outer condition of BOTH blocks, so when disabled, the entire rename block is skipped (both the immediate truncation AND the async haiku call). The guard goes on the existing `if` condition:
    ```js
    if (onTabRename && !text.startsWith('/') && getSetting('aiTabNaming') !== false) {
    ```
    `getSetting` is already imported at line 12 of ChatView.js — no new import needed.

    **TerminalManager.js:** There are two OSC rename call sites inside `handleClaudeTitleChange` — one for the working-state rename (~line 389-393) and one for the ready-candidate block (~line 402-407). Both call `updateTerminalTabName`. Add the `getSetting('aiTabNaming') !== false` guard as an AND condition with the existing `!shouldSkipOscRename(id)` check:
    ```js
    if (getSetting('aiTabNaming') !== false && !shouldSkipOscRename(id)) {
      updateTerminalTabName(id, parsed.taskName);
    }
    ```
    `getSetting` is already imported in TerminalManager.js — no new import needed.

    IMPORTANT: Do NOT add the guard inside `shouldSkipOscRename()` — keep the two concerns (AI naming toggle vs slash-command cooldown) separate.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && npm test 2>&1 | tail -5</automated>
    <manual>Grep for "aiTabNaming" across all three files — expect 1 hit in settings.state.js, 2 hits in ChatView.js, 2 hits in TerminalManager.js</manual>
  </verify>
  <done>aiTabNaming: true exists in defaultSettings; both ChatView generateTabName blocks gated; both TerminalManager OSC rename blocks gated; all guards use call-time getSetting read</done>
</task>

<task type="auto">
  <name>Task 2: Create Tabs settings group with AI tab naming toggle, move slash-command toggle, add i18n</name>
  <files>
    src/renderer/ui/panels/SettingsPanel.js
    src/renderer/i18n/locales/en.json
    src/renderer/i18n/locales/fr.json
  </files>
  <action>
    **SettingsPanel.js — Remove slash-command toggle from terminalGroup:**
    Find the `tabRenameOnSlashCommand` toggle row inside the terminal group (around lines 660-669). Remove only the toggle row div (the `settings-toggle-row` containing `tab-rename-slash-toggle`). Keep the `terminalGroup` div and its other content (idle timeout dropdown).

    **SettingsPanel.js — Add new Tabs group:**
    Insert a new `settings-group` div BEFORE the existing `terminalGroup` group. Use the exact HTML pattern from existing groups (e.g., explorerGroup). The new group contains two toggles:

    1. **AI tab naming toggle** (new):
       - Label: `${t('settings.aiTabNaming')}`
       - Description: `${t('settings.aiTabNamingDesc')}`
       - Checkbox ID: `ai-tab-naming-toggle`
       - Checked condition: `${settings.aiTabNaming !== false ? 'checked' : ''}`

    2. **Slash-command rename toggle** (moved, relabeled):
       - Label: `${t('settings.tabRenameOnSlashCommandTerminal')}`
       - Description: `${t('settings.tabRenameOnSlashCommandDesc')}` (reuse existing desc key)
       - Checkbox ID: `tab-rename-slash-toggle` (unchanged)
       - Checked condition: `${settings.tabRenameOnSlashCommand ? 'checked' : ''}` (unchanged — this one defaults to false/opt-in)

    Group title: `${t('settings.tabsGroup')}`

    **SettingsPanel.js — Save logic:**
    In the `collectSettings` / save function, add reading the new checkbox:
    ```js
    const aiTabNamingToggle = document.getElementById('ai-tab-naming-toggle');
    const newAiTabNaming = aiTabNamingToggle ? aiTabNamingToggle.checked : true;
    ```
    Add `aiTabNaming: newAiTabNaming` to the `newSettings` object. The existing `tabRenameOnSlashCommand` save line stays unchanged.

    **en.json:** Add these keys inside the `settings` object:
    ```json
    "tabsGroup": "Tabs",
    "aiTabNaming": "AI tab naming",
    "aiTabNamingDesc": "Use AI to generate short tab names from messages",
    "tabRenameOnSlashCommandTerminal": "Terminal: rename tab on slash command"
    ```

    **fr.json:** Add corresponding French translations:
    ```json
    "tabsGroup": "Onglets",
    "aiTabNaming": "Nommage IA des onglets",
    "aiTabNamingDesc": "Utiliser l'IA pour générer des noms courts pour les onglets à partir des messages",
    "tabRenameOnSlashCommandTerminal": "Terminal : renommer l'onglet sur commande slash"
    ```

    Keep the existing `tabRenameOnSlashCommand` and `tabRenameOnSlashCommandDesc` keys in both locale files (they may be referenced elsewhere). The new `tabRenameOnSlashCommandTerminal` key is used for the relabeled display in the Tabs group.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && npm run build:renderer 2>&1 | tail -3</automated>
    <manual>Grep for "tabsGroup" in SettingsPanel.js — expect 1 hit. Grep for "ai-tab-naming-toggle" — expect 2 hits (HTML render + save read). Grep for "tabsGroup" in en.json and fr.json — expect 1 hit each.</manual>
  </verify>
  <done>New Tabs settings group rendered with AI tab naming toggle (default ON) and relocated slash-command toggle; save logic persists aiTabNaming; i18n keys present in both EN and FR locale files; existing terminalGroup retains its other content</done>
</task>

</tasks>

<verification>
1. `npm test` passes — no regressions
2. `npm run build:renderer` succeeds — bundle compiles
3. Grep `aiTabNaming` across codebase — expect hits in: settings.state.js (1), ChatView.js (2), TerminalManager.js (2), SettingsPanel.js (3+), en.json (2), fr.json (2)
4. Grep `tabsGroup` — expect hits in SettingsPanel.js (1), en.json (1), fr.json (1)
5. The `tabRenameOnSlashCommand` toggle row is no longer inside the terminal group in SettingsPanel.js
</verification>

<success_criteria>
- Setting `aiTabNaming` defaults to `true` (no behavior change for existing users)
- Both ChatView.js generateTabName call sites skip rename when setting is false
- Both TerminalManager.js OSC rename call sites skip rename when setting is false
- New Tabs settings group appears in settings panel with both toggles
- Toggling takes effect immediately (call-time getSetting read, no restart needed)
- i18n strings present in both EN and FR
- Tests pass, renderer builds
</success_criteria>

<output>
After completion, create `.planning/phases/18-disable-haiki-tab-naming-settings-toggle/18-01-SUMMARY.md`
</output>

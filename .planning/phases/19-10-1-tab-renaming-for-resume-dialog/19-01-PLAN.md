---
phase: 19-10-1-tab-renaming-for-resume-dialog
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/ui/components/TerminalManager.js
  - styles/projects.css
autonomous: true
requirements:
  - TAB-RESUME-01
must_haves:
  truths:
    - "Resume session dialog shows the saved tab name (AI haiku, slash command, manual rename) instead of 'Untitled conversation' for sessions with a known name"
    - "Sessions without a saved tab name fall back to existing behavior (first prompt / summary / 'Untitled conversation')"
    - "Metadata text (timestamp, branch, info) in resume dialog entries is readable using the accent/theme color"
    - "Tab renames from both terminal-mode and chat-mode propagate to the resume dialog data store"
  artifacts:
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Tab name propagation to session-names.json via setSessionCustomName"
      contains: "setSessionCustomName"
    - path: "styles/projects.css"
      provides: "Accent-colored metadata in resume dialog"
      contains: "var(--accent)"
  key_links:
    - from: "updateTerminalTabName"
      to: "setSessionCustomName"
      via: "claudeSessionId bridge"
      pattern: "setSessionCustomName.*claudeSessionId"
    - from: "onTabRename (chat-mode)"
      to: "setSessionCustomName"
      via: "_chatSessionId bridge"
      pattern: "setSessionCustomName.*_chatSessionId"
---

<objective>
Propagate tab names to the resume session dialog and fix metadata readability.

Purpose: The resume session dialog (Phase 14 lightbulb button) currently shows "Untitled conversation" for sessions that have been renamed via AI haiku, slash commands, or manual edits. Tab names are stored in `terminal-sessions.json` (Phase 16) but never written to `session-names.json` (which the dialog reads). Additionally, metadata text (timestamp, branch) is nearly invisible due to muted color + low opacity.

Output: Two targeted changes — JS propagation in TerminalManager.js and CSS color fix in projects.css.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-10-1-tab-renaming-for-resume-dialog/19-RESEARCH.md
@src/renderer/ui/components/TerminalManager.js
@styles/projects.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Propagate tab names to session-names.json from both rename paths</name>
  <files>src/renderer/ui/components/TerminalManager.js</files>
  <action>
Two rename paths must be patched to propagate tab names into `session-names.json` (which the resume dialog reads via `getSessionCustomName`):

**Path A — terminal-mode (`updateTerminalTabName`, line ~1002):**
After the existing `updateTerminal(id, { name })` call and before the `saveTerminalSessions()` call, add:
```js
// Phase 19: propagate tab name to session-names.json (resume dialog)
if (termData.claudeSessionId && name) {
  setSessionCustomName(termData.claudeSessionId, name);
}
```
The guard `termData.claudeSessionId && name` ensures: (1) only sessions with a known Claude session ID are written, (2) empty/falsy names are not propagated (letting dialog fall back to its normal logic).

**Path B — chat-mode (`onTabRename` callback inside `createChatTerminal`, line ~3475):**
After `if (data) data.name = name;` and before the remote PWA notify block, add:
```js
// Phase 19: propagate tab name to session-names.json (resume dialog)
if (_chatSessionId && name) {
  setSessionCustomName(_chatSessionId, name);
}
```
`_chatSessionId` is the closure variable set by `onSessionStart` — it holds the real SDK session UUID. Guard with `&& name` to avoid writing empty strings.

**Important:** `setSessionCustomName` is already defined in this file (line ~2467) and writes synchronously to `session-names.json`. No new imports or functions needed.

**Edge case:** If `_chatSessionId` is null at rename time (first haiku before session starts), propagation is silently skipped — acceptable per research (subsequent renames will propagate once session ID arrives).
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && node -e "const src = require('fs').readFileSync('src/renderer/ui/components/TerminalManager.js','utf8'); const a = (src.match(/setSessionCustomName/g)||[]).length; console.log('setSessionCustomName calls:', a); if (a < 4) { console.error('FAIL: expected at least 4 occurrences (2 existing + 2 new)'); process.exit(1); } console.log('PASS');"</automated>
    <manual>Open resume dialog after renaming a tab — the saved name should appear instead of "Untitled conversation"</manual>
  </verify>
  <done>Both updateTerminalTabName (terminal-mode) and onTabRename (chat-mode) propagate non-empty tab names to session-names.json when a claudeSessionId is known</done>
</task>

<task type="auto">
  <name>Task 2: Fix metadata readability with accent color in resume dialog</name>
  <files>styles/projects.css</files>
  <action>
In `styles/projects.css`, update four CSS rule blocks to use the accent/theme color for all metadata elements in the resume session dialog:

**`.session-meta-item` (line ~1109):**
- Change `color: var(--text-muted)` → `color: var(--accent)`
- Change `opacity: 0.6` → `opacity: 0.85`

**`.session-meta-item svg` (line ~1119):**
- Change `opacity: 0.7` → `opacity: 1`

**`.session-meta-branch` (line ~1128):**
- Change `color: var(--text-muted)` → `color: var(--accent)`
- Change `opacity: 0.7` → `opacity: 0.85`
- Do NOT change `background: var(--bg-tertiary)` — keep the pill background as-is

**`.session-meta-branch svg` (line ~1145):**
- Change `opacity: 0.5` → `opacity: 1`

This ensures all 3 metadata elements (timestamp, branch, info text) and their SVG icons use the accent/theme color at visible opacity, fixing the current near-invisible state.
  </action>
  <verify>
    <automated>cd C:/Users/uhgde/source/repos/claude-terminal && node -e "const css = require('fs').readFileSync('styles/projects.css','utf8'); const metaItem = css.match(/\.session-meta-item\s*\{[^}]+\}/); const metaBranch = css.match(/\.session-meta-branch\s*\{[^}]+\}/); let ok = true; if (!metaItem[0].includes('var(--accent)')) { console.error('FAIL: .session-meta-item missing var(--accent)'); ok = false; } if (!metaBranch[0].includes('var(--accent)')) { console.error('FAIL: .session-meta-branch missing var(--accent)'); ok = false; } if (metaBranch[0].includes('var(--text-muted)')) { console.error('FAIL: .session-meta-branch still has var(--text-muted)'); ok = false; } if (ok) console.log('PASS'); else process.exit(1);"</automated>
    <manual>Open resume dialog and verify metadata text (timestamp, branch name) is readable with accent color</manual>
  </verify>
  <done>All metadata elements (.session-meta-item, .session-meta-branch) and their SVG children use var(--accent) at visible opacity (0.85/1.0)</done>
</task>

</tasks>

<verification>
1. `setSessionCustomName` appears at least 4 times in TerminalManager.js (2 existing definition/dialog usage + 2 new propagation calls)
2. `var(--accent)` appears in both `.session-meta-item` and `.session-meta-branch` rules
3. No `var(--text-muted)` remains in `.session-meta-item` or `.session-meta-branch` color declarations
4. `npm run build:renderer` succeeds
5. `npm test` passes
</verification>

<success_criteria>
- Tab names from any source (AI haiku, slash command, manual rename) appear in the resume session dialog instead of "Untitled conversation"
- Sessions without a saved tab name fall back to existing behavior (first prompt / summary / "Untitled conversation")
- Metadata text in resume dialog entries is readable with accent/theme color
- Both terminal-mode and chat-mode rename paths propagate to session-names.json
</success_criteria>

<output>
After completion, create `.planning/phases/19-10-1-tab-renaming-for-resume-dialog/19-01-SUMMARY.md`
</output>

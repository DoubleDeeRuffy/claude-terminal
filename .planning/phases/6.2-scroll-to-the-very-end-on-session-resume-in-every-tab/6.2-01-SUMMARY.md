---
phase: 6.2-scroll-to-the-very-end-on-session-resume-in-every-tab
plan: 01
subsystem: ui
tags: [xterm, terminal, scroll, session-restore, TerminalManager]

# Dependency graph
requires:
  - phase: 04-remember-every-tab-every-claude-session-and-the-session-context-accross-app-restarts
    provides: Terminal session restore loop in renderer.js and loading overlay dismissal in TerminalManager.js
  - phase: 06-resume-claude-sessions
    provides: Claude session resume with --resume flag and loading/ready status transitions
provides:
  - Post-restore scroll-all loop with 200ms delay in renderer.js scrolls all xterm terminals to bottom
  - scrollToBottom on loading->ready/working transition in TerminalManager.js covers resumed Claude session history replay
affects: [terminal-restore, session-resume, TerminalManager]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Deferred scroll after fit: setTimeout(200) ensures fitAddon.fit() (100ms) has completed before scrollToBottom()"
    - "Status-transition hook: scrollToBottom at loading->ready fires after session replay output is fully written"
    - "Chat-mode null guard: td.terminal && typeof td.terminal.scrollToBottom === 'function' skips null terminal objects"

key-files:
  created: []
  modified:
    - renderer.js
    - src/renderer/ui/components/TerminalManager.js

key-decisions:
  - "6.2-01: 200ms delay in renderer.js post-restore loop gives fitAddon.fit() (which fires at +100ms in createTerminal) time to complete"
  - "6.2-01: scrollToBottom added inside updateTerminalStatus loading->ready branch (after safety timeout cleanup) — fires once per terminal at exact moment history replay is done"
  - "6.2-01: Broader behavior accepted for TerminalManager scroll (fires on every loading->ready, not just restored sessions) — scroll to bottom when Claude first becomes ready is universally correct UX"

patterns-established:
  - "Post-restore scroll pattern: iterate terminalsState.get().terminals forEach after 200ms delay; guard td.terminal null for chat-mode tabs"

requirements-completed: [SESS-01]

# Metrics
duration: 1min
completed: 2026-02-26
---

# Phase 6.2 Plan 01: Scroll to Bottom on Session Resume Summary

**xterm.js scrollToBottom on all restored terminal tabs via 200ms post-restore loop and loading->ready status hook**

## Performance

- **Duration:** ~1 min
- **Started:** 2026-02-26T16:35:46Z
- **Completed:** 2026-02-26T16:36:43Z
- **Tasks:** 1
- **Files modified:** 2

## Accomplishments
- Added 200ms deferred scroll loop in renderer.js that iterates all terminals after session restore completes — covers all basic and non-resumed tabs
- Added scrollToBottom in TerminalManager.js updateTerminalStatus loading->ready/working branch — fires once after Claude session history replay output is fully written
- Both changes guarded against chat-mode tabs (td.terminal null check) to prevent runtime errors

## Task Commits

Each task was committed atomically:

1. **Task 1: Add post-restore scroll-all loop and loading->ready scroll hook** - `3868c085` (feat)

**Plan metadata:** *(pending final docs commit)*

## Files Created/Modified
- `renderer.js` - Added setTimeout(200) loop after lastOpenedProjectId block that calls scrollToBottom() on all xterm terminals
- `src/renderer/ui/components/TerminalManager.js` - Added scrollToBottom() call in updateTerminalStatus after loading overlay dismissal

## Decisions Made
- 200ms delay for post-restore scroll ensures fitAddon.fit() (fires at +100ms inside createTerminal) has completed — avoids race condition on slow machines
- scrollToBottom placed in updateTerminalStatus (not dismissLoadingOverlay) to fire once per terminal on the main code path only, not the 30s safety timeout path
- Accepted broader behavior: loading->ready scroll fires for all terminals (not just restored ones) — correct UX in all cases

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Self-Check: PASSED

All files exist and commit 3868c085 verified in git log.

## Next Phase Readiness
- Phase 6.3 (Remember active task on project scope) can proceed — this phase adds no new state or APIs, only UI scroll behavior
- No blockers

---
*Phase: 6.2-scroll-to-the-very-end-on-session-resume-in-every-tab*
*Completed: 2026-02-26*

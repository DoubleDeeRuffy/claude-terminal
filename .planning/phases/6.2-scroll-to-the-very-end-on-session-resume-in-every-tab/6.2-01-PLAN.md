---
phase: 6.2-scroll-to-the-very-end-on-session-resume-in-every-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - renderer.js
  - src/renderer/ui/components/TerminalManager.js
autonomous: true
requirements:
  - SESS-01
must_haves:
  truths:
    - "All restored terminal tabs show the most recent output (scrolled to bottom) after app restart"
    - "Resumed Claude sessions scroll to bottom after session history replay completes"
    - "Chat-mode tabs are unaffected (no errors, ChatView already handles its own scrolling)"
    - "Non-active restored tabs also scroll to bottom when user switches to them"
  artifacts:
    - path: "renderer.js"
      provides: "Post-restore scroll-all loop with 200ms delay"
      contains: "scrollToBottom"
    - path: "src/renderer/ui/components/TerminalManager.js"
      provides: "Scroll to bottom on loading→ready transition"
      contains: "scrollToBottom"
  key_links:
    - from: "renderer.js"
      to: "terminalsState.get().terminals"
      via: "forEach loop calling scrollToBottom on each xterm terminal"
      pattern: "td\\.terminal\\.scrollToBottom"
    - from: "src/renderer/ui/components/TerminalManager.js"
      to: "updateTerminalStatus loading→ready branch"
      via: "scrollToBottom after dismissLoadingOverlay"
      pattern: "scrollToBottom"
---

<objective>
Scroll all restored terminal tabs to the very bottom after app restart so users see the most recent output, not a mid-session scroll position.

Purpose: After Phase 4/6 terminal session restore, xterm.js terminals are created and data arrives asynchronously. Without an explicit scroll-to-bottom, restored tabs show content from the middle of the buffer — confusing UX.

Output: Two small code insertions — (1) a post-restore setTimeout loop in renderer.js that scrolls all terminals after fit completes, and (2) a scrollToBottom call in TerminalManager.js when the loading→ready status transition fires (covering resumed Claude sessions with large output replay).
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/6.2-scroll-to-the-very-end-on-session-resume-in-every-tab/6.2-RESEARCH.md
@renderer.js
@src/renderer/ui/components/TerminalManager.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add post-restore scroll-all loop and loading→ready scroll hook</name>
  <files>renderer.js, src/renderer/ui/components/TerminalManager.js</files>
  <action>
**In renderer.js** — after the `if (sessionData.lastOpenedProjectId) { ... }` block (around line 226, after the closing `}` of the lastOpenedProjectId block but before the `} catch (err)` line):

Insert a `setTimeout` with 200ms delay that iterates all terminals from `terminalsState.get().terminals` and calls `scrollToBottom()` on each xterm terminal instance. Guard with `td.terminal && typeof td.terminal.scrollToBottom === 'function'` to skip chat-mode tabs (where td.terminal is null).

```javascript
// Scroll all restored terminals to bottom after fit completes
setTimeout(() => {
  const terminals = terminalsState.get().terminals;
  terminals.forEach((td, id) => {
    if (td.terminal && typeof td.terminal.scrollToBottom === 'function') {
      td.terminal.scrollToBottom();
    }
  });
}, 200);
```

The 200ms delay ensures `fitAddon.fit()` (which fires at +100ms inside createTerminal) has completed before scroll is issued.

**In src/renderer/ui/components/TerminalManager.js** — inside the `updateTerminalStatus` function, in the `if (previousStatus === 'loading' && (status === 'ready' || status === 'working'))` branch (around line 1062), AFTER the existing `dismissLoadingOverlay(id)` call and the safety timeout cleanup block, add a `scrollToBottom()` call:

```javascript
// Scroll to bottom after session replay output has been written
const td = getTerminal(id);
if (td && td.terminal && typeof td.terminal.scrollToBottom === 'function') {
  td.terminal.scrollToBottom();
}
```

This fires when Claude transitions from loading→ready/working, which happens after session history replay output is written to the buffer — perfect timing for resumed sessions. Per research recommendation, accept the broader behavior (scroll on every loading→ready, not just restore) as it is universally correct UX.
  </action>
  <verify>
    <automated>npm run build:renderer &amp;&amp; npm test</automated>
    <manual>Restart the app with existing terminal sessions. All tabs should show the latest output scrolled to the very bottom. Switch between tabs — each should be at the bottom.</manual>
  </verify>
  <done>All restored xterm terminals scroll to the bottom after app restart. Resumed Claude sessions scroll to bottom after history replay. Chat-mode tabs produce no errors. Build and tests pass.</done>
</task>

</tasks>

<verification>
1. `npm run build:renderer` succeeds without errors
2. `npm test` passes all existing tests
3. `grep -n "scrollToBottom" renderer.js` shows the new post-restore scroll loop
4. `grep -n "scrollToBottom" src/renderer/ui/components/TerminalManager.js` shows the new loading→ready scroll call
5. No `scrollToBottom` calls on `null` terminal objects (chat-mode guard in place)
</verification>

<success_criteria>
- Restored terminal tabs display the most recent output at the bottom of the viewport
- Resumed Claude sessions scroll to bottom after session replay completes (loading→ready transition)
- Chat-mode tabs are unaffected (guarded by null check)
- Build and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/6.2-scroll-to-the-very-end-on-session-resume-in-every-tab/6.2-01-SUMMARY.md`
</output>

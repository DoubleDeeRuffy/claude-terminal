---
phase: 13-implement-a-setting-to-disable-chat-terminal-switchbutton-on-tabs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/state/settings.state.js
  - src/renderer/ui/panels/SettingsPanel.js
  - src/renderer/index.js
  - styles/terminal.css
  - src/renderer/i18n/locales/en.json
  - src/renderer/i18n/locales/fr.json
autonomous: true
requirements:
  - TAB-MODE-01

must_haves:
  truths:
    - "User sees a 'Show mode switch on tabs' toggle in Claude > Terminal settings group"
    - "Disabling the toggle immediately hides the Chat/Terminal switch button on all open terminal tabs"
    - "Re-enabling the toggle immediately shows the button again on hover"
    - "Setting persists across app restarts — hidden button stays hidden after relaunch"
    - "Fresh installs default to showing the button (safe upgrade path)"
  artifacts:
    - path: "src/renderer/state/settings.state.js"
      provides: "showTabModeToggle default setting"
      contains: "showTabModeToggle"
    - path: "src/renderer/ui/panels/SettingsPanel.js"
      provides: "Toggle UI in Claude > Terminal group and save handler"
      contains: "show-tab-mode-toggle"
    - path: "src/renderer/index.js"
      provides: "Startup body class application"
      contains: "hide-tab-mode-toggle"
    - path: "styles/terminal.css"
      provides: "CSS rule hiding .tab-mode-toggle via body class"
      contains: "hide-tab-mode-toggle"
    - path: "src/renderer/i18n/locales/en.json"
      provides: "English i18n strings"
      contains: "showTabModeToggle"
    - path: "src/renderer/i18n/locales/fr.json"
      provides: "French i18n strings"
      contains: "showTabModeToggle"
  key_links:
    - from: "src/renderer/ui/panels/SettingsPanel.js"
      to: "document.body.classList"
      via: "toggle('hide-tab-mode-toggle', !checked) in saveSettingsHandler"
      pattern: "classList\\.toggle.*hide-tab-mode-toggle"
    - from: "src/renderer/index.js"
      to: "document.body.classList"
      via: "add('hide-tab-mode-toggle') on startup when setting is false"
      pattern: "classList\\.add.*hide-tab-mode-toggle"
    - from: "styles/terminal.css"
      to: ".tab-mode-toggle"
      via: "body.hide-tab-mode-toggle .tab-mode-toggle { display: none !important }"
      pattern: "body\\.hide-tab-mode-toggle.*tab-mode-toggle"
---

<objective>
Add a settings toggle that controls whether the Chat/Terminal mode-switch button appears on terminal tabs. When disabled, the button is hidden via a body-level CSS class, locking tabs to whatever `defaultTerminalMode` dictates.

Purpose: Users who never use chat mode (or always use it) can declutter their tab UI by hiding the mode-switch button.
Output: Working toggle in Claude > Terminal settings, CSS hiding rule, i18n strings in both languages, startup persistence.
</objective>

<execution_context>
@C:/Users/uhgde/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/uhgde/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-implement-a-setting-to-disable-chat-terminal-switchbutton-on-tabs/13-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add showTabModeToggle setting default, CSS rule, startup body class, and i18n strings</name>
  <files>
    src/renderer/state/settings.state.js
    styles/terminal.css
    src/renderer/index.js
    src/renderer/i18n/locales/en.json
    src/renderer/i18n/locales/fr.json
  </files>
  <action>
1. **settings.state.js** — Add `showTabModeToggle: true` to `defaultSettings` object, positioned near `tabRenameOnSlashCommand` (the other Terminal-group boolean). The `loadSettings()` spread already handles new keys — no migration needed.

2. **terminal.css** — Add CSS rule immediately after the existing `.tab-mode-toggle` block:
```css
/* Hide mode toggle when setting is disabled */
body.hide-tab-mode-toggle .tab-mode-toggle {
  display: none !important;
}
```
Use `!important` to override the `.terminal-tab:hover .tab-mode-toggle { opacity: 1 }` rule — `display: none` must win over opacity/flex changes on hover.

3. **index.js** — After `initializeState()` (near the existing `compact-projects` body-class application), add:
```js
if (state.getSetting('showTabModeToggle') === false) {
  document.body.classList.add('hide-tab-mode-toggle');
}
```
Use `=== false` (not `!value`) so undefined/missing key defaults to NOT adding the class (button shown).

4. **en.json** — Add under the `settings` namespace (near `tabRenameOnSlashCommand` keys):
```json
"showTabModeToggle": "Show mode switch on tabs",
"showTabModeToggleDesc": "Show the Chat/Terminal switch button on terminal tabs (hover to reveal)"
```

5. **fr.json** — Add matching keys:
```json
"showTabModeToggle": "Afficher le bouton de changement de mode",
"showTabModeToggleDesc": "Afficher le bouton Chat/Terminal sur les onglets (visible au survol)"
```
  </action>
  <verify>
    <automated>npm run build:renderer &amp;&amp; grep -c "showTabModeToggle" src/renderer/state/settings.state.js src/renderer/index.js styles/terminal.css src/renderer/i18n/locales/en.json src/renderer/i18n/locales/fr.json</automated>
    <manual>Verify showTabModeToggle appears in all 5 files</manual>
  </verify>
  <done>showTabModeToggle default exists in settings.state.js; CSS body-class rule exists in terminal.css; startup class application exists in index.js; i18n keys exist in both en.json and fr.json</done>
</task>

<task type="auto">
  <name>Task 2: Add toggle UI in SettingsPanel and wire saveSettingsHandler</name>
  <files>
    src/renderer/ui/panels/SettingsPanel.js
  </files>
  <action>
1. **SettingsPanel.js — Toggle HTML** — In the Claude tab's `terminalGroup` section, add a second `settings-toggle-row` inside the existing `settings-card`, immediately after the `tabRenameOnSlashCommand` toggle row:
```html
<div class="settings-toggle-row">
  <div class="settings-toggle-label">
    <div>${t('settings.showTabModeToggle')}</div>
    <div class="settings-toggle-desc">${t('settings.showTabModeToggleDesc')}</div>
  </div>
  <label class="settings-toggle">
    <input type="checkbox" id="show-tab-mode-toggle" ${settings.showTabModeToggle !== false ? 'checked' : ''}>
    <span class="settings-toggle-slider"></span>
  </label>
</div>
```
CRITICAL: Use `settings.showTabModeToggle !== false ? 'checked' : ''` (NOT `settings.showTabModeToggle ? 'checked' : ''`) — undefined must default to checked (shown).

2. **SettingsPanel.js — saveSettingsHandler** — Read the checkbox value and include in newSettings:
```js
const showTabModeToggleEl = document.getElementById('show-tab-mode-toggle');
const newShowTabModeToggle = showTabModeToggleEl ? showTabModeToggleEl.checked : true;
```
Add `showTabModeToggle: newShowTabModeToggle` to the `newSettings` object literal.

3. **SettingsPanel.js — Body class toggle** — After `ctx.settingsState.set(newSettings)`, add:
```js
document.body.classList.toggle('hide-tab-mode-toggle', !newShowTabModeToggle);
```
This applies immediately to all open tabs without DOM iteration — the CSS rule on body handles it.
  </action>
  <verify>
    <automated>npm run build:renderer &amp;&amp; npm test &amp;&amp; grep -c "show-tab-mode-toggle" src/renderer/ui/panels/SettingsPanel.js</automated>
    <manual>Verify SettingsPanel has the toggle HTML (id="show-tab-mode-toggle"), the save handler reads it, and body class is toggled</manual>
  </verify>
  <done>SettingsPanel shows "Show mode switch on tabs" toggle in Claude > Terminal group; saving the toggle immediately hides/shows the mode-switch button on all tabs; setting value persists in newSettings object</done>
</task>

</tasks>

<verification>
1. `npm run build:renderer` succeeds without errors
2. `npm test` passes (no regressions)
3. `grep -r "showTabModeToggle" src/ styles/` returns hits in all 6 files
4. `grep "hide-tab-mode-toggle" src/renderer/index.js src/renderer/ui/panels/SettingsPanel.js styles/terminal.css` returns hits in all 3 files
5. The `!== false` guard is used (not truthy check) for the checkbox default
</verification>

<success_criteria>
- Toggle visible in Claude > Terminal settings group with correct label and description
- Disabling toggle immediately hides .tab-mode-toggle button on all terminal tabs (no reload needed)
- Re-enabling toggle immediately shows the button on hover as before
- Fresh install defaults to button shown (checkbox checked)
- Setting persists across app restarts (body class applied on startup)
- Both EN and FR i18n strings present
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/13-implement-a-setting-to-disable-chat-terminal-switchbutton-on-tabs/13-01-SUMMARY.md`
</output>

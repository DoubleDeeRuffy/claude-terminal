---
phase: 2.1-fix-pr-13-review-issues-for-terminal-keyboard-shortcuts
plan: 02
subsystem: ui
tags: [electron, keyboard-shortcuts, terminal, ipc, main-process, windows-snap]

# Dependency graph
requires:
  - phase: 2.1-fix-pr-13-review-issues-for-terminal-keyboard-shortcuts
    plan: 01
    provides: "flat shortcutXxx keys including shortcutCtrlArrowEnabled"
provides:
  - "ctrlArrowWordJumpEnabled flag with two-mode Ctrl+Left/Right handler in MainWindow.js"
  - "terminal:setCtrlArrowWordJumpEnabled IPC handler in terminal.ipc.js"
  - "setCtrlArrowWordJumpEnabled method in preload.js terminal namespace"
  - "Startup sync and live subscribe for shortcutCtrlArrowEnabled in renderer.js"
  - "Updated EN/FR i18n labels clarifying word-jump replaces tab switching"
  - "Branch rebased on fork's main and squashed to single commit"
affects: [phase-2.1-plan-03]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Two-mode Ctrl+Left/Right: always preventDefault (blocks Windows Snap); when word-jump enabled xterm handles natively, when disabled send IPC"
    - "Lazy require pattern in IPC handler for setCtrlArrowWordJumpEnabled (same as setCtrlTabEnabled)"
    - "Settings sync pattern: startup call + settingsState.subscribe diff for live sync to main process"

key-files:
  created: []
  modified:
    - src/main/windows/MainWindow.js
    - src/main/ipc/terminal.ipc.js
    - src/main/preload.js
    - renderer.js
    - src/renderer/i18n/locales/en.json
    - src/renderer/i18n/locales/fr.json

key-decisions:
  - "Always call event.preventDefault() on Ctrl+Left/Right to block Windows Snap regardless of word-jump setting"
  - "When word-jump enabled: no IPC sent, xterm receives event naturally for word-jump escape sequences"
  - "When word-jump disabled: send ctrl-arrow IPC for old tab-switch behavior"
  - "Lazy require in terminal.ipc.js handler avoids circular dep (same pattern as setCtrlTabEnabled)"
  - "Squash commit excludes docs(13) planning artifact commit — only source code changes in PR"

patterns-established:
  - "Two-mode before-input-event handler: always intercept + conditionally forward IPC based on feature flag"

requirements-completed: [TERM-03, TERM-05]

# Metrics
duration: 20min
completed: 2026-02-26
---

# Phase 2.1 Plan 02: Ctrl+Arrow Windows Snap Fix + IPC Chain + Branch Rebase Summary

**Restored Ctrl+Left/Right main-process intercept to block Windows Snap with two-mode routing (word-jump vs tab-switch), full IPC chain for setting sync, updated i18n labels, and rebased branch on fork's main as a single squash commit**

## Performance

- **Duration:** ~20 min
- **Started:** 2026-02-26T08:00:00Z
- **Completed:** 2026-02-26T08:16:11Z
- **Tasks:** 2
- **Files modified:** 6 (source code) + 1 git rebase operation

## Accomplishments

- Added `ctrlArrowWordJumpEnabled` module-level flag in MainWindow.js; two-mode handler always calls `event.preventDefault()` (blocks Windows Snap), then conditionally sends `ctrl-arrow` IPC only when word-jump is disabled
- Added `terminal:setCtrlArrowWordJumpEnabled` IPC handler in terminal.ipc.js using lazy require to avoid circular dependency
- Added `setCtrlArrowWordJumpEnabled` method in preload.js terminal namespace for renderer access
- Added startup sync and live `settingsState.subscribe` diff in renderer.js mirroring the ctrlTab pattern
- Updated EN/FR i18n labels for `termCtrlArrow` to clarify word-jump replaces tab switching
- Rebased `feat/terminal-keyboard-shortcuts` on fork's `origin/main` with no conflicts; squashed to 1 commit; force-pushed with lease

## Task Commits

Task 1 was committed atomically before squash; Task 2 used soft-reset + squash workflow:

1. **Task 1: Add ctrlArrowWordJumpEnabled two-mode handler + IPC chain + i18n** - `9a43675b` (feat)
2. **Task 2: Rebase and squash to single commit** - `f09f1481` (squash — final PR commit)

## Files Created/Modified

- `src/main/windows/MainWindow.js` - `ctrlArrowWordJumpEnabled` flag, two-mode Left/Right handler before Up/Down handler, `setCtrlArrowWordJumpEnabled` setter, exported in module.exports
- `src/main/ipc/terminal.ipc.js` - `terminal:setCtrlArrowWordJumpEnabled` handler with lazy require
- `src/main/preload.js` - `setCtrlArrowWordJumpEnabled` in terminal namespace
- `renderer.js` - Startup sync call + `_prevCtrlArrow` diff in settingsState.subscribe
- `src/renderer/i18n/locales/en.json` - `termCtrlArrow`: "Word jump (Ctrl+←/→) — replaces tab switching"
- `src/renderer/i18n/locales/fr.json` - `termCtrlArrow`: "Saut de mot (Ctrl+←/→) — remplace le changement d'onglet"

## Decisions Made

- Always call `event.preventDefault()` on Ctrl+Left/Right regardless of word-jump state — this is required to block Windows Snap on Windows. The key question was whether preventing default still lets xterm receive the event; yes it does because `event.preventDefault()` in `before-input-event` only prevents Chromium's default handling, but xterm's own keydown listener on the canvas still fires normally.
- Used lazy require in `terminal:setCtrlArrowWordJumpEnabled` handler (same pattern as phase 04 and the existing `terminal:setCtrlTabEnabled`) to avoid circular dep between terminal.ipc.js and MainWindow.js.
- The `docs(13)` planning-artifact commit was excluded from the squash — only source code changes go into the PR commit.

## Deviations from Plan

None - plan executed exactly as written. The rebase had no conflicts (origin/main only added `.planning/` files on top of the branch's merge base).

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Plan 2.1-02 complete; branch is rebased on fork's main and squashed to a single clean commit
- Plan 2.1-03 (PR submission) can now proceed — the branch is ready to push upstream

---
*Phase: 2.1-fix-pr-13-review-issues-for-terminal-keyboard-shortcuts*
*Completed: 2026-02-26*

## Self-Check: PASSED

- SUMMARY.md: FOUND at `.planning/phases/2.1-fix-pr-13-review-issues-for-terminal-keyboard-shortcuts/2.1-02-SUMMARY.md`
- Commit `f09f1481`: FOUND (squash commit — final PR commit on feat/terminal-keyboard-shortcuts)
- `grep -c ctrlArrowWordJumpEnabled src/main/windows/MainWindow.js`: 3 (flag + handler check + setter) — PASSED
- `grep setCtrlArrowWordJumpEnabled src/main/ipc/terminal.ipc.js`: IPC handler present — PASSED
- `grep setCtrlArrowWordJumpEnabled src/main/preload.js`: preload method present — PASSED
- `grep setCtrlArrowWordJumpEnabled renderer.js`: startup sync + subscribe diff — PASSED (2 matches)
- `git log --oneline origin/main..HEAD | wc -l`: 1 (single squash commit) — PASSED
- `npm run build:renderer`: Build complete — PASSED
- `npm test`: 262/262 tests — PASSED
